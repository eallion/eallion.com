{{ define "main" }}
{{ .Scratch.Set "scope" "single" }}

<article>
  {{ if .Params.showHero | default (.Site.Params.article.showHero | default false) }}
  {{ $heroStyle := .Params.heroStyle }}
  {{ if not $heroStyle }}{{ $heroStyle = .Site.Params.article.heroStyle }}{{ end }}
  {{ $heroStyle := print "hero/" $heroStyle ".html" }}
  {{ if templates.Exists ( printf "partials/%s" $heroStyle ) }}
  {{ partial $heroStyle . }}
  {{ else }}
  {{ partial "hero/basic.html" . }}
  {{ end }}
  {{ end }}

  <header id="single_header" class="mt-5 max-w-prose">
    {{ if .Params.showBreadcrumbs | default (.Site.Params.article.showBreadcrumbs | default false) }}
    {{ partial "breadcrumbs.html" . }}
    {{ end }}
    <h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">
      {{ .Title }}
    </h1>
    <div class="mt-1 mb-6 text-base text-neutral-500 print:hidden">
      {{ partial "article-meta/basic.html" (dict "context" . "scope" "single") }}
    </div>

  </header>

  <section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row">

    <div class="min-w-0 min-h-0 max-w-fit">

      <div class="article-content max-w-full mb-20">
        {{ .Content }}

        <div class="flex w-full mt-10 flex-wrap justify-center gap-5">

          {{ $mastodonData := "" }}
          {{ with resources.Get "data/mastodon/mastodon.json" }}
            {{ $mastodonData = . | transform.Unmarshal }}
          {{ end }}

          <div class="order-2 md:order-1 mt-container w-full max-w-full md:max-w-[calc(100%-282px)] p-0">
            {{ if $mastodonData }}
              {{ range $post := $mastodonData }}
                {{ $postContent := $post.content }}
                {{ if $post.reblog }}
                  {{ $postContent = $post.reblog.content }}
                {{ end }}

                <article class="border border-neutral-400 dark:border-neutral-500 rounded-xl mb-8 p-4 pb-3 shadow-sm transition-all duration-200">

                  {{ if $post.reblog }}
                    <div class="mt-reblog flex items-center gap-2 mb-2 text-neutral-500 text-sm">
                      <span class="text-green-500">üîÑ</span>
                      <span>Charles Chin ËΩ¨Âèë‰∫Ü</span>
                    </div>
                  {{ end }}

                  <!-- Â§¥ÂÉèÈÉ®ÂàÜ -->
                  <div class="flex items-center flex-row gap-2">
                    <div class="mt-reblog-avatar w-12 h-12 rounded-lg mr-3 flex-shrink-0 relative">
                      {{ $avatarUrl := "/eallion.png" }}
                      {{ if $post.reblog }}
                        {{ $avatarUrl = replace $post.reblog.account.avatar "https://files.e5n.cc/" "https://mstd-s3-files.eallion.com/" }}
                      {{ end }}
                      <img src="{{ $avatarUrl }}" alt="Â§¥ÂÉè" class="w-full h-full mt-0 mb-0 object-cover rounded-lg no-view nozoom" no-view onerror="this.src='/assets/images/mastodon/missing.png'">
                      {{ if $post.reblog }}
                        <div class="mt-reblog-avatar-overlay absolute -bottom-1 -right-1 w-2/3 h-2/3 no-view">
                          <img src="/favicon-32x32.png" alt="Boost" class="w-full h-full mt-0 mb-0 object-cover nozoom" no-view>
                        </div>
                      {{ end }}
                    </div>
                    <div class="flex-1 flex flex-row items-start min-w-0">
                      <div class="flex flex-col flex-wrap items-start gap-0 mb-1">
                        {{ $displayName := "Charles Chin" }}
                        {{ $acct := "@eallion@e5n.cc" }}
                        {{ if $post.reblog }}
                          {{ $displayName = $post.reblog.account.display_name }}
                          {{ $acct = $post.reblog.account.acct }}
                        {{ end }}
                        <span class="mt-accout-name font-semibold hover:font-extrabold text-neutral-700 hover:text-neutral-900 dark:text-neutral-200 dark:hover:text-neutral-100">{{ $displayName }}</span>
                        <a href="https://e5n.cc/@eallion" target="_blank" rel="noopener noreferrer" class="mt-accout-id text-neutral-700 dark:text-neutral-200 text-sm hover:underline">{{ $acct }}</a>
                      </div>
                      <div class="inline md:hidden px-2 py-1.5 text-neutral-600 hover:text-neutral-700 dark:hover:text-neutral-400 text-sm ml-auto">
                        {{ $postUrl := default "https://e5n.cc/@eallion" $post.url }}
                        <span class="mt-footer-date" data-created-at="{{ $post.created_at }}"><a href="{{ $postUrl }}" target="_blank" rel="noopener noreferrer" class="text-neutral-600 dark:text-neutral-500 hover:text-neutral-700 dark:hover:text-neutral-400">-</a></span>
                      </div>
                      <div class="hidden md:flex flex-row items-center gap-1.5 ml-auto px-2 text-sm ">
                        <span class="mt-meta-language">
                          {{ if $post.language }}
                            {{ if or (eq $post.language "zh") (eq $post.language "zh-cn") }}
                              zh-CN
                            {{ else }}
                              {{ $post.language }}
                            {{ end }}
                          {{ end }}
                        </span>
                        {{ if (findRE "http" $postContent) }}
                          <span class="mt-meta-link"><svg xmlns="http://www.w3.org/2000/svg" width="1rem" height="1rem" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path stroke-dasharray="48" stroke-dashoffset="48" d="M11 5h-6v14h14v-6"><animate fill="freeze" attributeName="stroke-dashoffset" dur="0.6s" values="48;0"/></path><path stroke-dasharray="12" stroke-dashoffset="12" d="M13 11l7 -7"><animate fill="freeze" attributeName="stroke-dashoffset" begin="0.6s" dur="0.2s" values="12;0"/></path><path stroke-dasharray="8" stroke-dashoffset="8" d="M21 3h-6M21 3v6"><animate fill="freeze" attributeName="stroke-dashoffset" begin="0.8s" dur="0.2s" values="8;0"/></path></g></svg></span>
                        {{ end }}
                        {{ if gt (len $post.media_attachments) 0 }}
                          <span class="mt-meta-image"><svg xmlns="http://www.w3.org/2000/svg" width="1rem" height="1rem" viewBox="0 0 48 48"><g fill="none" stroke="currentColor" stroke-linejoin="round" stroke-width="4"><path stroke-linecap="round" d="M5 10C5 8.89543 5.89543 8 7 8L41 8C42.1046 8 43 8.89543 43 10V38C43 39.1046 42.1046 40 41 40H7C5.89543 40 5 39.1046 5 38V10Z" clip-rule="evenodd"/><path stroke-linecap="round" d="M14.5 18C15.3284 18 16 17.3284 16 16.5C16 15.6716 15.3284 15 14.5 15C13.6716 15 13 15.6716 13 16.5C13 17.3284 13.6716 18 14.5 18Z" clip-rule="evenodd"/><path fill="#2f88ff" d="M15 24L20 28L26 21L43 34V38C43 39.1046 42.1046 40 41 40H7C5.89543 40 5 39.1046 5 38V34L15 24Z"/></g></svg></span>
                        {{ end }}
                        {{ if $post.in_reply_to_id }}
                          <span class="mt-meta-reply"><svg xmlns="http://www.w3.org/2000/svg" width="1rem" height="1rem" viewBox="0 0 24 24"><path fill="currentColor" d="M12 23a1 1 0 0 1-1-1v-3H7a2 2 0 0 1-2-2V7a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-4.1l-3.7 3.71c-.2.18-.44.29-.7.29zm-9-8H1V3a2 2 0 0 1 2-2h16v2H3z"/></svg></span>
                        {{ end }}
                        {{ if $post.reblog }}
                          <span class="mt-meta-reblog"><svg xmlns="http://www.w3.org/2000/svg" width="1.13rem" height="1rem" viewBox="0 0 576 512"><path fill="currentColor" d="M272 416c17.7 0 32-14.3 32-32s-14.3-32-32-32H160c-17.7 0-32-14.3-32-32V192h32c12.9 0 24.6-7.8 29.6-19.8s2.2-25.7-6.9-34.9l-64-64c-12.5-12.5-32.8-12.5-45.3 0l-64 64c-9.2 9.2-11.9 22.9-6.9 34.9S19.1 192 32.1 192h32v128c0 53 43 96 96 96h112zm32-320c-17.7 0-32 14.3-32 32s14.3 32 32 32h112c17.7 0 32 14.3 32 32v128h-32c-12.9 0-24.6 7.8-29.6 19.8s-2.2 25.7 6.9 34.9l64 64c12.5 12.5 32.8 12.5 45.3 0l64-64c9.2-9.2 11.9-22.9 6.9-34.9S556.9 320 543.9 320h-32V192c0-53-43-96-96-96z"/></svg></span>
                        {{ end }}
                        <span class="mt-meta-visibility">
                          {{ if eq $post.visibility "direct" }}
                            <svg xmlns="http://www.w3.org/2000/svg" height="1.1rem" viewBox="0 -960 960 960" width="1.1rem" class="icon icon-envelope status__visibility-icon" title="ÁßÅ‰∏ãÊèêÂèä" aria-label="ÁßÅ‰∏ãÊèêÂèä" role="img"><path fill="#d32f2f" d="M160-160q-33 0-56.5-23.5T80-240v-480q0-33 23.5-56.5T160-800h640q33 0 56.5 23.5T880-720v480q0 33-23.5 56.5T800-160H160Zm320-280L160-640v400h640v-400L480-440Zm0-80 320-200H160l320 200ZM160-640v-80 480-400Z"></path></svg>
                          {{ else if eq $post.visibility "unlisted" }}
                            <svg xmlns="http://www.w3.org/2000/svg" height="1.1rem" viewBox="0 -960 960 960" width="1.1rem" class="icon icon-unlock status__visibility-icon" title="ÊÇÑÊÇÑÂÖ¨ÂºÄ" aria-label="ÊÇÑÊÇÑÂÖ¨ÂºÄ" role="img"><path fill="#388e3c" d="M484-80q-84 0-157.5-32t-128-86.5Q144-253 112-326.5T80-484q0-146 93-257.5T410-880q-18 99 11 193.5T521-521q71 71 165.5 100T880-410q-26 144-138 237T484-80Zm0-80q88 0 163-44t118-121q-86-8-163-43.5T464-465q-61-61-97-138t-43-163q-77 43-120.5 118.5T160-484q0 135 94.5 229.5T484-160Zm-20-305Z"></path></svg>
                          {{ else if eq $post.visibility "private" }}
                            <svg xmlns="http://www.w3.org/2000/svg" height="1.1rem" viewBox="0 -960 960 960" width="1.1rem" class="icon icon-lock status__visibility-icon" title="ÂÖ≥Ê≥®ËÄÖ" aria-label="ÂÖ≥Ê≥®ËÄÖ" role="img"><path fill="#ffa000" d="M240-80q-33 0-56.5-23.5T160-160v-400q0-33 23.5-56.5T240-640h40v-80q0-83 58.5-141.5T480-920q83 0 141.5 58.5T680-720v80h40q33 0 56.5 23.5T800-560v400q0 33-23.5 56.5T720-80H240Zm0-80h480v-400H240v400Zm240-120q33 0 56.5-23.5T560-360q0-33-23.5-56.5T480-440q-33 0-56.5 23.5T400-360q0 33 23.5 56.5T480-280ZM360-640h240v-80q0-50-35-85t-85-35q-50 0-85 35t-35 85v80ZM240-160v-400 400Z"></path></svg>
                          {{ else }}
                            <svg xmlns="http://www.w3.org/2000/svg" height="1.1rem" viewBox="0 -960 960 960" width="1.1rem" class="icon icon-globe status__visibility-icon" title="ÂÖ¨ÂºÄ" aria-label="ÂÖ¨ÂºÄ" role="img"><path fill="#1976d2" d="M480-80q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Zm-40-82v-78q-33 0-56.5-23.5T360-320v-40L168-552q-3 18-5.5 36t-2.5 36q0 121 79.5 212T440-162Zm276-102q41-45 62.5-100.5T800-480q0-98-54.5-179T600-776v16q0 33-23.5 56.5T520-680h-80v80q0 17-11.5 28.5T400-560h-80v80h240q17 0 28.5 11.5T600-440v120h40q26 0 47 15.5t29 40.5Z"></path></svg>
                          {{ end }}
                        </span>
                      </div>
                    </div>
                  </div>

                  {{ $currentPostId := $post.id }}
                  {{ $inReplyToId := $post.in_reply_to_id }}
                  {{ $isThread := false }}
                  {{ $threadPosition := 1 }}
                  {{ $threadTotal := 1 }}

                  {{ if $inReplyToId }}
                    {{ $isThread = true }}
                    {{ $threadPosition = 1 }}
                    {{ $currentReplyId := $inReplyToId }}

                    <!-- Âêë‰∏äÊü•Êâæ‰∏≤ÁöÑÂºÄÂßã -->
                    {{ range $checkPost := $mastodonData }}
                      {{ if eq $checkPost.id $currentReplyId }}
                        {{ $threadPosition = add $threadPosition 1 }}
                        {{ if $checkPost.in_reply_to_id }}
                          {{ $currentReplyId = $checkPost.in_reply_to_id }}
                        {{ else }}
                          {{ break }}
                        {{ end }}
                      {{ end }}
                    {{ end }}

                    <!-- ËÆ°ÁÆó‰∏≤ÁöÑÊÄªÈïøÂ∫¶ -->
                    {{ $threadTotal = $threadPosition }}
                    {{ range $checkPost := $mastodonData }}
                      {{ if eq $checkPost.in_reply_to_id $currentPostId }}
                        {{ $threadTotal = add $threadTotal 1 }}
                      {{ end }}
                    {{ end }}
                  {{ else }}
                    <!-- Ê£ÄÊü•ÊòØÂê¶ÊúâÂõûÂ§çÂΩìÂâçÂ∏ñÂ≠êÁöÑ -->
                    {{ range $checkPost := $mastodonData }}
                      {{ if eq $checkPost.in_reply_to_id $currentPostId }}
                        {{ $isThread = true }}
                        {{ $threadTotal = add $threadTotal 1 }}
                      {{ end }}
                    {{ end }}
                  {{ end }}

                  {{ if $isThread }}
                    <div class="align-middle inline-flex items-center text-[10px] leading-none uppercase opacity-75 font-bold gap-1 border rounded-md p-1">
                      <span data-icon="thread" class="icon  " style="width: 12px; height: 12px;">
                        <svg viewBox="0 0 24 24"><g fill="none" fill-rule="evenodd"><path d="M24 0v24H0V0h24ZM12.593 23.258l-.011.002l-.071.035l-.02.004l-.014-.004l-.071-.035c-.01-.004-.019-.001-.024.005l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427c-.002-.01-.009-.017-.017-.018Zm.265-.113l-.013.002l-.185.093l-.01.01l-.003.011l.018.43l.005.012l.008.007l.201.093c.012.004.023 0 .029-.008l.004-.014l-.034-.614c-.003-.012-.01-.02-.02-.022Zm-.715.002a.023.023 0 0 0-.027.006l-.006.014l-.034.614c0 .012.007.02.017.024l.015-.002l.201-.093l.01-.008l.004-.011l.017-.43l-.003-.012l-.01-.01l-.184-.092Z"></path><path fill="currentColor" d="M18 16a3 3 0 1 1 0 6a3 3 0 0 1 0-6ZM15.5 4a4.5 4.5 0 1 1 0 9h-7a2.5 2.5 0 0 0 0 5H13a1 1 0 1 1 0 2H8.5a4.5 4.5 0 1 1 0-9h7a2.5 2.5 0 0 0 0-5H11a1 1 0 1 1 0-2h4.5ZM18 18a1 1 0 1 0 0 2a1 1 0 0 0 0-2ZM6 2a3 3 0 1 1 0 6a3 3 0 0 1 0-6Zm0 2a1 1 0 1 0 0 2a1 1 0 0 0 0-2Z"></path></g></svg>
                      </span>
                      ÂòüÊñá‰∏≤ {{ $threadPosition }}/X
                    </div>
                  {{ end }}

                  <!-- ÂÜÖÂÆπÈÉ®ÂàÜ -->
                  <div class="mt-content mb-4">
                    <p class="mb-2">
                      {{ $postContent | safeHTML }}
                    </p>

                    {{ if gt (len $post.media_attachments) 0 }}
                      <div class="mt-images-container mb-3 aspect-[16/9] rounded-xl overflow-hidden relative">
                        {{ if or $post.sensitive (and $post.reblog $post.reblog.sensitive) }}
                          <div class="absolute inset-0 bg-neutral-800 opacity-99 flex flex-col items-center justify-center z-10 rounded-lg cursor-pointer" onclick="this.style.display='none'">
                            <div class="text-white font-bold text-lg mb-2">‚ö†Ô∏è</div>
                            <div class="text-neutral-400 text-3xl mt-4 mb-4">NSFW</div>
                            <div class="flex items-center text-neutral-400 text-xl">ÁÇπÂáªÊòæÁ§∫ÂõæÁâá</div>
                          </div>
                        {{ end }}

                        {{ $mediaCount := len $post.media_attachments }}
                        {{ if eq $mediaCount 1 }}
                          <!-- ÂçïÂº†ÂõæÁâá -->
                          {{ $mediaItem := index $post.media_attachments 0 }}
                          {{ $imgWidth := 0 }}
                          {{ $imgHeight := 0 }}
                          {{ $aspectRatio := 1 }}
                          {{ if $mediaItem.meta }}
                            {{ if $mediaItem.meta.small }}
                              {{ $imgWidth = $mediaItem.meta.small.width }}
                              {{ $imgHeight = $mediaItem.meta.small.height }}
                              {{ $aspectRatio = $mediaItem.meta.small.aspect }}
                            {{ end }}
                          {{ end }}
                          {{ $objectFitClass := "object-contain" }}
                          {{ if and (gt $imgWidth 640) (ge $aspectRatio 1.33) (le $aspectRatio 1.78) }}
                            {{ $objectFitClass = "object-cover" }}
                          {{ end }}
                          {{ $mediaStyleName := "!mastodon.webp" }}
                          {{ if gt $imgHeight 400 }}
                            {{ $mediaStyleName = "!mastodon400.webp" }}
                          {{ end }}
                          <div class="flex flex-row h-full">
                            <div class="w-full rounded-xl overflow-hidden">
                              {{ if $mediaItem.blurhash }}
                                <canvas class="absolute inset-0 -z-1 w-full h-full top-0 object-cover" data-blurhash="{{ $mediaItem.blurhash }}"></canvas>
                              {{ end }}
                              <a href="{{ replace $mediaItem.url "https://files.e5n.cc/" "https://mstd-s3-files.eallion.com/" }}!mastodonview.webp">
                                <img src="{{ replace $mediaItem.preview_url "https://files.e5n.cc/" "https://mstd-s3-files.eallion.com/" }}{{ $mediaStyleName }}" alt="{{ $mediaItem.description }}" class="w-full h-full {{ $objectFitClass }}" nozoom loading="lazy">
                              </a>
                            </div>
                          </div>
                        {{ else if eq $mediaCount 2 }}
                          <!-- ‰∏§Âº†ÂõæÁâá -->
                          <div class="flex flex-row h-full gap-2.5">
                            {{ range $index, $mediaItem := first 2 $post.media_attachments }}
                              {{ $imgWidth := 0 }}
                              {{ $aspectRatio := 1 }}
                              {{ if $mediaItem.meta }}
                                {{ if $mediaItem.meta.small }}
                                  {{ $imgWidth = $mediaItem.meta.small.width }}
                                  {{ $aspectRatio = $mediaItem.meta.small.aspect }}
                                {{ end }}
                              {{ end }}
                              {{ $objectFitClass := "object-cover" }}
                              {{ if or (lt $imgWidth 320) (lt $aspectRatio 0.56) (gt $aspectRatio 2.3) }}
                                {{ $objectFitClass = "object-contain" }}
                              {{ end }}
                              {{ $alignmentClass := "" }}
                              {{ if eq $index 0 }}{{ $alignmentClass = "left-0" }}{{ else }}{{ $alignmentClass = "right-0" }}{{ end }}
                              <div class="relative w-1/2 rounded-xl overflow-hidden">
                                {{ if $mediaItem.blurhash }}
                                  <canvas class="absolute inset-0 -z-1 w-full h-full top-0 object-contain {{ $alignmentClass }}" data-blurhash="{{ $mediaItem.blurhash }}"></canvas>
                                {{ end }}
                                <a href="{{ replace $mediaItem.url "https://files.e5n.cc/" "https://mstd-s3-files.eallion.com/" }}!mastodonview.webp">
                                  <img src="{{ replace $mediaItem.preview_url "https://files.e5n.cc/" "https://mstd-s3-files.eallion.com/" }}{{ $mediaStyleName }}" alt="{{ $mediaItem.description }}" class="w-full h-full {{ $objectFitClass }}" nozoom loading="lazy">
                                </a>
                              </div>
                            {{ end }}
                          </div>
                        {{ else if eq $mediaCount 3 }}
                          <!-- ‰∏âÂº†ÂõæÁâá -->
                          {{ $firstItem := index $post.media_attachments 0 }}
                          {{ $secondItem := index $post.media_attachments 1 }}
                          {{ $thirdItem := index $post.media_attachments 2 }}

                          {{ $firstImgWidth := 0 }}
                          {{ $firstAspectRatio := 1 }}
                          {{ if $firstItem.meta }}
                            {{ if $firstItem.meta.small }}
                              {{ $firstImgWidth = $firstItem.meta.small.width }}
                              {{ $firstAspectRatio = $firstItem.meta.small.aspect }}
                            {{ end }}
                          {{ end }}
                          {{ $firstObjectFitClass := "object-cover" }}
                          {{ if or (lt $firstImgWidth 320) (lt $firstAspectRatio 0.56) (gt $firstAspectRatio 2.3) }}
                            {{ $firstObjectFitClass = "object-contain" }}
                          {{ end }}

                          {{ $secondImgWidth := 0 }}
                          {{ $secondAspectRatio := 1 }}
                          {{ if $secondItem.meta }}
                            {{ if $secondItem.meta.small }}
                              {{ $secondImgWidth = $secondItem.meta.small.width }}
                              {{ $secondAspectRatio = $secondItem.meta.small.aspect }}
                            {{ end }}
                          {{ end }}
                          {{ $secondObjectFitClass := "object-cover" }}
                          {{ if or (lt $secondImgWidth 320) (lt $secondAspectRatio 0.56) (gt $secondAspectRatio 2.3) }}
                            {{ $secondObjectFitClass = "object-contain" }}
                          {{ end }}

                          {{ $thirdImgWidth := 0 }}
                          {{ $thirdAspectRatio := 1 }}
                          {{ if $thirdItem.meta }}
                            {{ if $thirdItem.meta.small }}
                              {{ $thirdImgWidth = $thirdItem.meta.small.width }}
                              {{ $thirdAspectRatio = $thirdItem.meta.small.aspect }}
                            {{ end }}
                          {{ end }}
                          {{ $thirdObjectFitClass := "object-cover" }}
                          {{ if or (lt $thirdImgWidth 320) (lt $thirdAspectRatio 0.56) (gt $thirdAspectRatio 2.3) }}
                            {{ $thirdObjectFitClass = "object-contain" }}
                          {{ end }}

                          <div class="flex h-full gap-2.5">
                            <div class="relative w-1/2 overflow-hidden rounded-xl">
                              {{ if $firstItem.blurhash }}
                                <canvas class="absolute inset-0 -z-1 w-full h-full top-0 left-0 object-contain" data-blurhash="{{ $firstItem.blurhash }}"></canvas>
                              {{ end }}
                              <a href="{{ replace $firstItem.url "https://files.e5n.cc/" "https://mstd-s3-files.eallion.com/" }}!mastodonview.webp">
                                <img src="{{ replace $firstItem.preview_url "https://files.e5n.cc/" "https://mstd-s3-files.eallion.com/" }}{{ $mediaStyleName }}" alt="{{ $firstItem.description }}" class="w-full h-full {{ $firstObjectFitClass }}" nozoom loading="lazy">
                              </a>
                            </div>
                            <div class="w-1/2 flex flex-col gap-2.5">
                              <div class="relative h-1/2 overflow-hidden rounded-xl">
                                {{ if $secondItem.blurhash }}
                                  <canvas class="absolute inset-0 -z-1 w-full h-full top-0 right-0 object-contain" data-blurhash="{{ $secondItem.blurhash }}"></canvas>
                                {{ end }}
                                <a href="{{ replace $secondItem.url "https://files.e5n.cc/" "https://mstd-s3-files.eallion.com/" }}!mastodonview.webp">
                                  <img src="{{ replace $secondItem.preview_url "https://files.e5n.cc/" "https://mstd-s3-files.eallion.com/" }}{{ $mediaStyleName }}" alt="{{ $secondItem.description }}" class="w-full h-full {{ $secondObjectFitClass }}" nozoom loading="lazy">
                                </a>
                              </div>
                              <div class="relative h-1/2 overflow-hidden rounded-xl">
                                {{ if $thirdItem.blurhash }}
                                  <canvas class="absolute inset-0 -z-1 w-full h-full bottom-0 right-0 object-contain" data-blurhash="{{ $thirdItem.blurhash }}"></canvas>
                                {{ end }}
                                <a href="{{ replace $thirdItem.url "https://files.e5n.cc/" "https://mstd-s3-files.eallion.com/" }}!mastodonview.webp">
                                  <img src="{{ replace $thirdItem.preview_url "https://files.e5n.cc/" "https://mstd-s3-files.eallion.com/" }}{{ $mediaStyleName }}" alt="{{ $thirdItem.description }}" class="w-full h-full {{ $thirdObjectFitClass }}" nozoom loading="lazy">
                                </a>
                              </div>
                            </div>
                          </div>
                        {{ else }}
                          <!-- ÂõõÂº†ÊàñÊõ¥Â§öÂõæÁâá -->
                          <div class="grid grid-cols-2 grid-rows-2 h-full gap-2.5">
                            {{ range first 4 $post.media_attachments }}
                              {{ $imgWidth := 0 }}
                              {{ $aspectRatio := 1 }}
                              {{ if .meta }}
                                {{ if .meta.small }}
                                  {{ $imgWidth = .meta.small.width }}
                                  {{ $aspectRatio = .meta.small.aspect }}
                                {{ end }}
                              {{ end }}
                              {{ $objectFitClass := "object-cover" }}
                              {{ if or (lt $imgWidth 320) (lt $aspectRatio 0.56) (gt $aspectRatio 2.3) }}
                                {{ $objectFitClass = "object-contain" }}
                              {{ end }}
                              <div class="relative overflow-hidden rounded-xl">
                                {{ if .blurhash }}
                                  <canvas class="absolute inset-0 -z-1 w-full h-full object-contain" data-blurhash="{{ .blurhash }}"></canvas>
                                {{ end }}
                                <a href="{{ replace .url "https://files.e5n.cc/" "https://mstd-s3-files.eallion.com/" }}!mastodonview.webp">
                                  <img src="{{ replace .preview_url "https://files.e5n.cc/" "https://mstd-s3-files.eallion.com/" }}{{ $mediaStyleName }}" alt="{{ .description }}" class="w-full h-full {{ $objectFitClass }}" nozoom loading="lazy">
                                </a>
                              </div>
                            {{ end }}
                          </div>
                        {{ end }}
                      </div>
                    {{ end }}
                  </div>

                  <!-- Â∫ïÈÉ®ÊåâÈíÆ -->
                  <div class="flex justify-between md:justify-start items-center gap-4 pt-3 border-t border-neutral-300 dark:border-neutral-700">
                    {{ $postUrl := default "https://e5n.cc/@eallion" $post.url }}
                    <button onclick="window.open('{{ $postUrl }}', '_blank')" class="flex items-center gap-1 px-2 py-1.5 text-neutral-600 dark:text-neutral-500 hover:text-neutral-700 dark:hover:text-neutral-400 hover:bg-neutral-300 dark:hover:bg-neutral-700 rounded-md transition-all duration-200 text-sm">
                      <span><svg xmlns="http://www.w3.org/2000/svg" width="1rem" height="1rem" viewBox="0 0 512 512"><path fill="currentColor" d="M204.2 18.4c12 5 19.8 16.6 19.8 29.6v80h112c97.2 0 176 78.8 176 176c0 113.3-81.5 163.9-100.2 174.1c-2.5 1.4-5.3 1.9-8.1 1.9c-10.9 0-19.7-8.9-19.7-19.7c0-7.5 4.3-14.4 9.8-19.5c9.4-8.8 22.2-26.4 22.2-56.7c0-53-43-96-96-96h-96v80c0 12.9-7.8 24.6-19.8 29.6s-25.7 2.2-34.9-6.9l-160-160c-12.5-12.5-12.5-32.8 0-45.3l160-160c9.2-9.2 22.9-11.9 34.9-6.9z" /></svg></span>
                      {{ if $post.replies_count }}<span class="mt-footer-reply">{{ $post.replies_count }}</span>{{ end }}
                    </button>
                    <button onclick="window.open('{{ $postUrl }}', '_blank')" class="flex items-center gap-1 px-2 py-1.5 text-neutral-600 dark:text-neutral-500 hover:text-neutral-700 dark:hover:text-neutral-400 hover:bg-neutral-300 dark:hover:bg-neutral-700 rounded-md transition-all duration-200 text-sm">
                      <span><svg xmlns="http://www.w3.org/2000/svg" width="1.13rem" height="1rem" viewBox="0 0 576 512"><path fill="currentColor" d="M118.6 41.4c-12.5-12.5-32.8-12.5-45.3 0l-64 64c-9.2 9.2-11.9 22.9-6.9 34.9S19.1 160 32 160h32v224c0 53 43 96 96 96h128c17.7 0 32-14.3 32-32s-14.3-32-32-32H160c-17.7 0-32-14.3-32-32V160h32c12.9 0 24.6-7.8 29.6-19.8s2.2-25.7-6.9-34.9l-64-64zm338.8 429.2c12.5 12.5 32.8 12.5 45.3 0l64-64c9.2-9.2 11.9-22.9 6.9-34.9S556.9 352 544 352h-32V128c0-53-43-96-96-96H288c-17.7 0-32 14.3-32 32s14.3 32 32 32h128c17.7 0 32 14.3 32 32v224h-32c-12.9 0-24.6 7.8-29.6 19.8s-2.2 25.7 6.9 34.9l64 64z" /></svg></span>
                      {{ if $post.reblogs_count }}<span class="mt-footer-reblog">{{ $post.reblogs_count }}</span>{{ end }}
                    </button>
                    <button onclick="window.open('{{ $postUrl }}', '_blank')" class="flex items-center gap-1 px-2 py-1.5 text-neutral-600 dark:text-neutral-500 hover:text-neutral-700 dark:hover:text-neutral-400 hover:bg-neutral-300 dark:hover:bg-neutral-700 rounded-md transition-all duration-200 text-sm">
                      <span><svg xmlns="http://www.w3.org/2000/svg" width="1.13rem" height="1rem" viewBox="0 0 576 512"><path fill="currentColor" d="M309.5-18.9c-4.1-8-12.4-13.1-21.4-13.1s-17.3 5.1-21.4 13.1l-73.6 144.2l-159.9 25.4c-8.9 1.4-16.3 7.7-19.1 16.3s-.5 18 5.8 24.4l114.4 114.5l-25.2 159.9c-1.4 8.9 2.3 17.9 9.6 23.2s16.9 6.1 25 2l144.4-73.4L432.4 491c8 4.1 17.7 3.3 25-2s11-14.2 9.6-23.2l-25.3-159.9l114.4-114.5c6.4-6.4 8.6-15.8 5.8-24.4s-10.1-14.9-19.1-16.3L383 125.3z" /></svg></span>
                      {{ if $post.favourites_count }}<span class="mt-footer-favourit">{{ $post.favourites_count }}</span>{{ end }}
                    </button>
                    <button onclick="window.open('{{ $postUrl }}', '_blank')" class="flex items-center gap-1 px-2 py-1.5 text-neutral-600 dark:text-neutral-500 hover:text-neutral-700 dark:hover:text-neutral-400 hover:bg-neutral-300 dark:hover:bg-neutral-700 rounded-md transition-all duration-200 text-sm">
                      <span><svg xmlns="http://www.w3.org/2000/svg" width="0.75rem" height="1rem" viewBox="0 0 384 512"><path fill="currentColor" d="M64 0C28.7 0 0 28.7 0 64v416c0 11.5 6.2 22.2 16.2 27.8s22.3 5.5 32.2-.4L192 421.3l143.5 86.1c9.9 5.9 22.2 6.1 32.2.4S384 491.5 384 480V64c0-35.3-28.7-64-64-64z" /></svg></span>
                      {{ if $post.bookmarked }}<span class="mt-footer-favourit">{{ $post.bookmarked }}</span>{{ end }}
                    </button>
                    <button onclick="window.open('{{ $postUrl }}', '_blank')" class="flex items-center gap-1 px-2 py-1.5 text-neutral-600 dark:text-neutral-500 hover:text-neutral-700 dark:hover:text-neutral-400 hover:bg-neutral-300 dark:hover:bg-neutral-700 rounded-md transition-all duration-200 text-sm">
                      <span><svg xmlns="http://www.w3.org/2000/svg" width="0.88rem" height="1rem" viewBox="0 0 448 512"><path fill="currentColor"d="M0 256a56 56 0 1 1 112 0a56 56 0 1 1-112 0m168 0a56 56 0 1 1 112 0a56 56 0 1 1-112 0m224-56a56 56 0 1 1 0 112a56 56 0 1 1 0-112" /></svg></span>
                    </button>
                    <div class="hidden md:inline px-2 py-1.5 text-neutral-600 hover:text-neutral-700 dark:hover:text-neutral-400 text-sm ml-auto">
                      <span class="mt-footer-date" data-created-at="{{ $post.created_at }}"><a href="{{ $postUrl }}" target="_blank" rel="noopener noreferrer" class="text-neutral-600 dark:text-neutral-500 hover:text-neutral-700 dark:hover:text-neutral-400">-</a></span>
                    </div>
                  </div>

                </article>
              {{ end }}
            {{ end }}
          </div>

          <div class="order-1 md:order-2 relative md:sticky ease-in-out duration-300 top-unset md:top-20 w-full md:w-[262px] h-full md:h-[540px] mb-10 md:mb-0">
            <div class="h-unset md:h-[540px] w-full md:w-[262px] max-w-full md:max-w-[262px] bg-neutral-50 dark:bg-neutral-800 rounded-xl shadow-md overflow-hidden transition-colors duration-300 hover:shadow-lg">
              <div class="h-24 bg-gradient-to-b from-primary-600 to-primary-400 dark:from-primary-600 dark:to-primary-900 relative">
                <div class="absolute -bottom-10 left-4">
                  <div class="h-20 w-20 rounded-xl bg-neutral dark:bg-primary-600 p-2 shadow-md overflow-hidden cursor-pointer"><a href="https://e5n.cc/@eallion" target="_blank" rel="noopener noreferrer"><img
                      src="/eallion.png" alt="Charles Chin"
                      class="h-full w-full object-cover rounded-lg mt-0 mb-0 no-view nozoom"></a></div>
                </div>
                <div class="absolute top-2 right-2 bg-primary-400 text-neutral-50 p-1 rounded-full"
                  alt="This account has been verified as authentic by our team."><svg xmlns="http://www.w3.org/2000/svg"
                    class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd"
                      d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
                      clip-rule="evenodd"></path>
                  </svg></div>
                <a
                  href="https://mastodon.social/@eallion/3726552"
                  target="_blank"
                  class="absolute bottom-2 right-2 bg-neutral/10 backdrop-blur-sm border border-neutral/20 text-neutral hover:text-neutral dark:hover:text-neutral px-3 py-1.5 rounded-full hover:rounded-full z-50 text-xs flex items-center gap-1.5 shadow-sm w-max hover:cursor-pointer text-center"
                  alt="Sat, Apr 22, 2017. 05:13:40"><svg xmlns="http://www.w3.org/2000/svg" width="0.875rem" height="0.875rem"
                    viewBox="0 0 24 24">
                    <path fill="currentColor" fill-rule="evenodd"
                      d="M12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10s-4.477 10-10 10m8-10a8 8 0 1 0-16 0a8 8 0 0 0 16 0m-4-1a1 1 0 0 1 0 2h-3c-1.1 0-2-.9-2-2V7a1 1 0 0 1 2 0v4z" />
                  </svg><span class="text-xs font-medium">
                    Âä†ÂÖ•‰∫é
                    <span class="relative inline-block min-w-8">
                      <span class="relative opacity-100 visible transition-all duration-300 ease-in-out
                        pointer-events-none"
                        {{ if and $mastodonData (gt (len $mastodonData) 0) }}
                        data-created-at="2017-04-22T05:13:40.810Z"
                        {{ end }}>Apr. 22, 2017
                      </span>
                    </span>
                  </span>
                </a>
              </div>
              <div class="p-4 pt-12">
                <div class="mb-3">
                  <h3 class="mt-0 mb-0 truncate cursor-pointer"><a href="https://e5n.cc/@eallion" target="_blank" rel="noopener noreferrer" class="font-bold text-neutral-900 dark:text-neutral-50">Charles Chin</a></h3>
                  <p class="mt-0 mb-0 truncate"><a href="https://e5n.cc/@eallion" target="_blank" rel="noopener noreferrer" class="text-sm text-neutral-500 dark:text-neutral-400">eallion@e5n.cc</a></p>
                </div>
                <div class="flex flex-col h-auto md:h-28 justify-between">
                  <div class="hidden md:block">
                    <p class="mt-0 mb-0 text-neutral-600 dark:text-neutral-300">
                      Welcome!
                      <ul class="mt-0 mb-0 flex flex-col text-sm text-neutral-600 dark:text-neutral-300">
                        <li class="mx-0 list-item">It's a single mode Mastodon.</li>
                        <li class="mx-0 list-item">Registrations closed.</li>
                        <li class="mx-0 list-item">Private but public readable.</li>
                        <li class="mx-0 list-item"><ruby>‰∏≠Êñá<rt>Chinese</rt></ruby> content with a little English mixed in.</li>
                        <li class="mx-0 list-item">Talk to myself.</li>
                        <li class="mx-0 list-item">talk about myself.</li>
                      </ul>
                    </p>
                  </div>
                  <div class="flex justify-between items-center mb-0 mt-auto">
                    <div>
                      <div class="text-xs text-neutral-500 dark:text-neutral-400">ÂÖ≥Ê≥®ËÄÖ</div>
                      <div class="font-semibold dark:text-neutral-200 flex items-center">
                        <span id="followers">
                          {{ if and $mastodonData (gt (len $mastodonData) 0) }}
                            {{ (index $mastodonData 0).account.followers_count }}
                          {{ else }}
                            -1
                          {{ end }}
                        </span>
                      </div>
                    </div>
                    <div>
                      <div class="text-xs text-neutral-500 dark:text-neutral-400">Ê≠£Âú®ÂÖ≥Ê≥®</div>
                      <div class="font-semibold dark:text-neutral-200 flex items-center">
                        <span id="following">
                          {{ if and $mastodonData (gt (len $mastodonData) 0) }}
                            {{ (index $mastodonData 0).account.following_count }}
                          {{ else }}
                            0
                          {{ end }}
                        </span>
                      </div>
                    </div>
                    <div>
                      <div class="text-xs text-neutral-500 dark:text-neutral-400">ÂòüÊñá</div>
                      <div class="font-semibold dark:text-neutral-200 flex items-center">
                        <span id="statuses">
                          {{ if and $mastodonData (gt (len $mastodonData) 0) }}
                            {{ (index $mastodonData 0).account.statuses_count }}
                          {{ else }}
                            0
                          {{ end }}
                        </span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

        </div>

      </div>
    </div>
  </section>
</article>

<script>
// ËÆ°ÁÆóÁõ∏ÂØπÊó∂Èó¥ÁöÑÂáΩÊï∞
function getRelativeTime(dateString) {
  const rtf = new Intl.RelativeTimeFormat('zh-CN', { numeric: "auto", style: 'short' });
  const now = new Date();
  const date = new Date(dateString);
  const diff = now - date;

  const seconds = Math.floor(diff / 1000);
  const minutes = Math.floor(seconds / 60);
  const hours = Math.floor(minutes / 60);
  const days = Math.floor(hours / 24);
  const months = Math.floor(days / 30);
  const years = Math.floor(days / 365);

  let formattedTime;
  if (years > 0) {
    formattedTime = rtf.format(-years, 'year');
  } else if (months > 0) {
    formattedTime = rtf.format(-months, 'month');
  } else if (days > 0) {
    formattedTime = rtf.format(-days, 'day');
  } else if (hours > 0) {
    formattedTime = rtf.format(-hours, 'hour');
  } else if (minutes > 0) {
    formattedTime = rtf.format(-minutes, 'minute');
  } else {
    formattedTime = rtf.format(-seconds, 'second');
  }

  return formattedTime.replace(/(\d+)([^\d]+)/, '$1 $2');
}

// Êõ¥Êñ∞ÊâÄÊúâÂ∏¶Êúâ data-created-at Â±ûÊÄßÁöÑÊó∂Èó¥ÂÖÉÁ¥†
function updateRelativeTimes() {
  const timeElements = document.querySelectorAll('[data-created-at]');
  timeElements.forEach(element => {
    const dateString = element.getAttribute('data-created-at');
    if (dateString) {
      element.textContent = getRelativeTime(dateString);
    }
  });
}

// È°µÈù¢Âä†ËΩΩÂÆåÊàêÂêéÂàùÂßãÂåñÊó∂Èó¥ÊòæÁ§∫
document.addEventListener('DOMContentLoaded', function() {
  updateRelativeTimes();
  // ÊØèÂàÜÈíüÊõ¥Êñ∞‰∏ÄÊ¨°Êó∂Èó¥ÊòæÁ§∫
  setInterval(updateRelativeTimes, 60000);
});

</script>

{{ $fastBlurhashJS := resources.Get "js/fast-blurhash.min.js" | fingerprint "sha256" }}
<script type="module">
  // ÂØºÂÖ• Blurhash Ëß£Á†ÅÂô®
  import { decodeBlurHash } from '{{ $fastBlurhashJS.RelPermalink }}?v=1.1.4';

  // ‰∏ªÊ∏≤ÊüìÂáΩÊï∞
  async function renderBlurhashCanvases() {
    // ÈÄâÊã©ÊâÄÊúâÂ∏¶ data-blurhash Â±ûÊÄßÁöÑ canvas
    const canvases = document.querySelectorAll('canvas[data-blurhash]');

    for (const canvas of canvases) {
      const blurhash = canvas.getAttribute('data-blurhash');
      if (!blurhash) continue;

      // Ëß£Á†Å BlurhashÔºàÂêåÊ≠•Êìç‰ΩúÔºâ
      const pixels = decodeBlurHash(blurhash, 32, 32);

      // ËÆæÁΩÆ canvas Â∞∫ÂØ∏
      canvas.width = 32;
      canvas.height = 32;

      // ÁªòÂà∂Âà∞ canvas
      const ctx = canvas.getContext('2d');
      const imageData = new ImageData(pixels, 32, 32);
      ctx.putImageData(imageData, 0, 0);
    }
  }

  // ‰ΩøÁî® MutationObserver Ê£ÄÊµã DOM ÂèòÂåñ
  function setupObserver() {
    const observer = new MutationObserver(mutations => {
      let shouldRender = false;

      // Ê£ÄÊü•ÊòØÂê¶Êñ∞Â¢û‰∫ÜÂ∏¶ data-blurhash ÁöÑ canvas
      mutations.forEach(mutation => {
        if (mutation.type !== 'childList') return;

        mutation.addedNodes.forEach(node => {
          if (node.nodeName === 'CANVAS' && node.dataset.blurhash) {
            shouldRender = true;
          }
          // Ê£ÄÊü•Â≠êËäÇÁÇπ‰∏≠ÁöÑ canvas
          if (node.querySelectorAll) {
            const canvases = node.querySelectorAll('canvas[data-blurhash]');
            if (canvases.length > 0) shouldRender = true;
          }
        });
      });

      if (shouldRender) renderBlurhashCanvases();
    });

    // ÂºÄÂßãËßÇÂØüÊï¥‰∏™ÊñáÊ°£
    observer.observe(document.documentElement, {
      childList: true,
      subtree: true
    });

    // ÂàùÂßãÊ∏≤ÊüìÂ∑≤ÊúâÂÖÉÁ¥†
    renderBlurhashCanvases();
  }

  // È°µÈù¢Âä†ËΩΩÂÆåÊàêÂêéÂêØÂä® Observer
  document.addEventListener('DOMContentLoaded', setupObserver);
</script>

{{ $viewJS := resources.Get "js/view-image.min.js" | fingerprint "sha256" }}
<script type="text/javascript" src="{{ $viewJS.RelPermalink }}" integrity="{{ $viewJS.Data.Integrity }}"></script>

<script>
    window.ViewImage && ViewImage.init('.mt-images-container a');
</script>

{{ end }}
