{{ define "main" }}
{{ .Scratch.Set "scope" "single" }}

<style>
html {
    height: 100%;
}

body {
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    margin: 0;
}

main {
    flex-grow: 1;
}
</style>

<article class="container mx-auto px-4 py-8">

  <section class="flex flex-col max-w-full mt-0">

    <div class="min-w-0 min-h-0">

      <div class="article-content max-w-full">

      <div class="bg-gray max-w-[800px] mx-auto rounded-2xl shadow-xl overflow-hidden">
        <div class="p-6 border-b border-[#f3f4f6]">
          <h2 class="flex items-center">
            <svg xmlns="http://www.w3.org/2000/svg" width="1.5rem" height="1.5rem" viewBox="0 0 24 24">
              <g fill="none" stroke="#fe8401" stroke-width="1.5">
                <path stroke-linecap="round" stroke-linejoin="round" d="M8.237 22.603A11.25 11.25 0 1 1 23.25 12" />
                <path stroke-linecap="round" stroke-linejoin="round"
                  d="M9.29 1.079c-1.52 2.233-2.539 6.287-2.539 10.92a24.6 24.6 0 0 0 1.515 8.96M.777 11.25h11.974M3 5.25h18M2.05 17.249h7.7m4.962-16.17a17 17 0 0 1 2.3 7.136" />
                <path d="M17.25 21a.375.375 0 0 1 0-.75m0 .75a.375.375 0 0 0 0-.75" />
                <path stroke-linecap="round" stroke-linejoin="round"
                  d="M17.25 18v-3m5.813 5.683a1.774 1.774 0 0 1-1.587 2.567h-8.452a1.773 1.773 0 0 1-1.587-2.567l4.226-8.452a1.774 1.774 0 0 1 3.174 0z" />
              </g>
            </svg>
            <span class="ml-2 text-2xl font-bold text-[#1f2937]">跳转提示</span>
          </h2>
        </div>

        <div class="p-6">

          <div class="scrolling-container overflow-hidden rounded-xl bg-gray-100 p-4">
            <div class="flex flex-col items-center scrolling-wrapper animate-scroll-left hover:animation-paused">

              <div class="text-xl font-bold mt-1 mb-8 px-2 text-gray-800 mr-auto">即将离开<span class="inline-block">eallion's Blog</span>，前往：</div>

              <div class="flex w-full max-w-full">
                <span class="inline-flex items-center px-3 text-sm text-gray-900 bg-gray-300 border rounded-e-0 border-gray-300 border-e-0 rounded-s-md">
                  <img id="domain-icon" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxLjVyZW0iIGhlaWdodD0iMS41cmVtIiB2aWV3Qm94PSIwIDAgMTI4IDEyOCI+PHBhdGggZmlsbD0iIzFlYmJlZSIgZD0iTTEyNi4xMSA2Ni44MzRjMC05LjgyLTIuNTM5LTE5LjAzNC02Ljk5MS0yNy4wNTFDMTM4LjA5Ny0zLjE2NyA5OC43ODUgMy4xMyA5Ni41OTYgMy41NThjLTguMzI4IDEuNjI5LTE2LjAzNCA0LjI0OS0yMy4xNDIgNy41NjZhNTYgNTYgMCAwIDAtMy4xNjYtLjA5Yy0yNi41MjUgMC00OC43MjkgMTguNTAxLTU0LjQxMSA0My4zMDNjMTMuOTgtMTUuNjg0IDIzLjc2NS0yMi4wMTIgMjkuNjI0LTI0LjU0NHEtMS40MDIgMS4yNTQtMi43NTEgMi41MzJsLS44ODUuODU1Yy0uNTk0LjU3MS0xLjE4NiAxLjE0My0xLjc2NSAxLjcyYy0uMzQ0LjM0My0uNjguNjg5LTEuMDE5IDEuMDM1Yy0uNTE0LjUyMi0xLjAyNiAxLjA0NC0xLjUyNyAxLjU2OWwtMS4wNTIgMS4xMjJxLS43MDQuNzUyLTEuMzkgMS41MDZsLTEuMDUzIDEuMTc1YTE0MyAxNDMgMCAwIDAtMy41MTYgNC4wOTlxLS41MjIuNjI5LTEuMDMxIDEuMjU2cS0uNTQ5LjY4LTEuMDgzIDEuMzU2cS0uNTI0LjY1Ny0xLjAzNCAxLjMxMmwtLjk1MyAxLjI0NmMtLjM1Ni40NjktLjcxNS45MzgtMS4wNjMgMS40MDRsLS43MzEuOTk4YTE3NCAxNzQgMCAwIDAtNi4wNDEgOC43OTZsLS4wMTMuMDIxYy0uNDc5Ljc0Ny0uOTQxIDEuNDgyLTEuMzk1IDIuMjExbC0uMDc0LjEycS0uNjggMS4wOTYtMS4zMTkgMi4xNjRsLS4wNDUuMDc1YTE4MiAxODIgMCAwIDAtMy4xNzIgNS41MDFDNy41NjIgODAuOTc3IDUuMTE0IDg3LjM0MyA1LjAwOCA4Ny43MmMtMTUuODc2IDU2Ljc1OSAzMy42NzQgMzIuNzkxIDQwLjU4OCAyOS4yMTNjNy40NDUgMy42NzggMTUuODI3IDUuOTczIDI0LjY5MiA1Ljk3M0M5NC41NjMgMTIyLjkwNSAxMTUuMjEzIDEwNyAxMjIuOSA4Nkg5My41NjljLTQuMzQgNy0xMi42OTQgMTIuMDQ5LTIyLjI5MyAxMi4wNDlDNTcuMjExIDk4LjA0OSA0NS44MSA4NyA0NS44MSA3NGg3OS44NDJjLjMwMy0yIC40NTgtNC43My40NTgtNy4xNjZNMTMuNTI2IDExNi44MTdjLTMuOTE2LTQuMDE1LTQuNjA4LTEzLjc5NSA0LjAzMi0zMS42MTZjNC4zNiAxMi41MzcgMTMuMDYxIDIzLjA0MSAyNC4zMDcgMjkuNzA4Yy01LjU5MyAzLjA3OS0yMC40NDEgMTAuMDA5LTI4LjMzOSAxLjkwOE00NS42ODcgNTljLjQ0Ni0xMyAxMS41NjQtMjMuMDA1IDI1LjIyNi0yMy4wMDVTOTUuNjk0IDQ2IDk2LjE0IDU5em00NC43NzYtNDQuMjA0YzUuMTY2LTIuNDk1IDE3Ljk1OC03Ljc3MSAyNS4yMi0yLjg3MWM0LjgwNyAzLjI0NSA4LjY2MyA4LjM0IDIuMDQyIDI1LjQ5OWMtNi4zNTEtMTAuMjEzLTE1LjkwNS0xOC4yMjQtMjcuMjYyLTIyLjYyOCIvPjwvc3ZnPg==" class="icon-img rounded-full w-6 h-6 mt-0 mb-0" alt="favicon">
                </span>
                <div type="text" id="redirect-link" class="rounded-none rounded-e-lg bg-gray-50 border text-gray-600 focus:ring-blue-400 focus:border-blue-500 block flex-1 min-w-0 w-full text-sm border-gray-300 p-2.5"></div>
              </div>

              <div class="w-full flex flex-col md:flex-row justify-between mt-8 mb-8 gap-4">

                  <button type="button" id="direct-link" class="max-w-fit self-center-safe text-white bg-blue-700 hover:bg-blue-800 hover:cursor-pointer focus:ring-4 focus:outline-hidden focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center inline-flex items-center">
                  继续访问外部网站
                    <svg class="rtl:rotate-180 w-3.5 h-3.5 ms-2" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 10">
                      <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M1 5h12m0 0L9 1m4 4L9 9"/>
                    </svg>
                  </button>
                <div class="flex self-center gap-4">
                  <button type="button" onclick="goBack()" class="py-2.5 px-5 text-sm font-medium text-gray-900 focus:outline-hidden bg-gray rounded-xl border-blue-700 border-2 hover:bg-gray-100 hover:cursor-pointer hover:text-blue-700 focus:z-10 focus:ring-4 focus:ring-gray-200">
                  返回
                  </button>

                <div class="">
                  <button type="button" onclick="window.close()" class="py-2.5 px-5 text-sm font-medium text-gray-900 focus:outline-hidden bg-gray rounded-xl border-2 border-blue-700 hover:bg-gray-100 hover:text-blue-700 hover:cursor-pointer focus:z-10 focus:ring-4 focus:ring-gray-200">关闭</button>
                </div>

                </div>
              </div>
              <div>
                <p class="text-sm mt-2 mb-2 px-4 text-gray-600">
                  如果您点击<span class="inline-block">「继续访问外部网站」</span>就会离开本网站。该链接不属于本网站，我们无法确认该网页是否安全。
                </p>
              </div>
            </div>
          </div>

          <div class="mt-6 p-4 bg-[#8dc9ff] rounded-lg border border-blue-300">
            <h3 class="font-semibold text-[#1e40af] flex items-center">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd"
                  d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"
                  clip-rule="evenodd" />
              </svg>
              安全小贴士
            </h3>
            <ul class="mt-2 text-sm text-[#1d4ed8] list-disc pl-5 space-y-1">
              <li>仔细辨认网址是否为钓鱼网站、山寨网站、镜像网站</li>
              <li>请注意信息安全，不要随便输入账号、密码和隐私信息</li>
              <li>请注意财产安全，不确定时不要进行任何金钱交易操作</li>
              <li>不要下载来历不明的软件，不要忽略安全软件的提醒</li>
              <li>不是认为自己的隐私信息不重要</li>
            </ul>
          </div>
        </div>
      </div>

      </div>

    </div>

  </section>

</article>

<script>
  const params = new URLSearchParams(window.location.search);
  const encodedTarget = params.get('target');
  if (encodedTarget) {
      try {
          const target = atob(encodedTarget);
          const decodedTarget = decodeURIComponent(target);

          // 检查目标 URL 是否已经包含查询字符串
          const hasQueryString = decodedTarget.includes('?');
          const separator = hasQueryString ? '&' : '?';
          const directLink = decodedTarget + separator + 'ref=www.eallion.com';

          // 设置重定向链接
          const directLinkId = document.getElementById('direct-link');
          directLinkId.addEventListener('click', () => {
              window.open(directLink, "_self");
          });
          document.getElementById('redirect-link').textContent = decodedTarget;
          document.getElementById('redirect-link').href = directLink;

          // 新增功能：提取域名获取 favicon
          // 提取域名的函数
          function extractDomain(url) {
              try {
                  // 处理以//开头的 URL (protocol-relative)
                  let sanitizedUrl = url;
                  if (sanitizedUrl.startsWith('//')) {
                      sanitizedUrl = 'https:' + sanitizedUrl;
                  }
                  // 处理缺少协议的 URL
                  else if (!sanitizedUrl.includes('://')) {
                      sanitizedUrl = 'https://' + sanitizedUrl;
                  }

                  // 使用 URL 接口解析域名
                  const urlObj = new URL(sanitizedUrl);
                  return urlObj.protocol + '//' + urlObj.hostname;
              } catch (e) {
                  console.error('域名提取失败：', e);
                  return null;
              }
          }

          // 提取域名
          const domain = extractDomain(decodedTarget);

          // 设置 favicon 图片
          const iconImg = document.getElementById('domain-icon');
          if (domain) {
              const faviconUrl = `https://t3.gstatic.cn/faviconV2?client=SOCIAL&type=FAVICON&fallback_opts=TYPE,SIZE,URL&size=64&url=${encodeURIComponent(domain)}`;

              // 保存原始源
              const defaultSrc = iconImg.src;

              // 尝试加载新图标
              iconImg.onerror = function() {
                  // 加载失败时恢复默认图标
                  this.onerror = null;
                  this.src = defaultSrc;
              };

              // 设置新图片源
              iconImg.src = faviconUrl;
          }
      } catch (e) {
          document.getElementById('redirect-link').textContent = '未指定重定向目标。';
      }
  } else {
      document.getElementById('redirect-link').textContent = '未指定重定向目标。';
  }

  function goBack() {
    // 如果有打开者窗口，则聚焦它
    if (window.opener && !window.opener.closed) {
      window.opener.focus();
    }

    // 尝试关闭当前窗口
    window.close();

    // 处理无法关闭的情况（非脚本打开的窗口）
    setTimeout(() => {
      if (!window.closed) {
        window.location.href = "/"; // 重定向到首页
      }
    }, 1000);
  }
</script>

{{ end }}
