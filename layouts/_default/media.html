{{ define "main" }}
{{ .Scratch.Set "scope" "single" }}

<article>
  {{ if .Params.showHero | default (.Site.Params.article.showHero | default false) }}
  {{ $heroStyle := .Params.heroStyle }}
  {{ if not $heroStyle }}{{ $heroStyle = .Site.Params.article.heroStyle }}{{ end }}
  {{ $heroStyle := print "partials/hero/" $heroStyle ".html" }}
  {{ if templates.Exists $heroStyle }}
  {{ partial $heroStyle . }}
  {{ else }}
  {{ partial "partials/hero/basic.html" . }}
  {{ end }}
  {{ end }}

  <div class="fixed h-auto w-full left-0 right-0 top-0 -z-10 after:absolute after:top-0 after:left-0 after:right-0 after:h-full after:bg-gradient-to-b after:from-[var(--media-bg-color-from)] after:from-0% after:to-[var(--media-bg-color-to)] dark:after:to-[var(--media-bg-color-to-dark)] after:to-100%">
    <div id="player_id" class="video-source object-cover"></div>

    <script type="text/javascript" src="https://player.dogecloud.com/js/loader"></script>
    <script type="text/javascript">
        // 获取设备的屏幕宽度和高度
        const screenWidth = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;
        const screenHeight = window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight;

        // 定义宽大于高和宽小于高的 vcode 列表
        const wideVcodes = [
            '316b55455894bf63',
            '7f253d2bec2b0692',
            'a12bcc250a6bf95c',
            '51346b1fe0f1587f',
            'fa85b94d81515a62',
            '1d05771431c85566',
            '0dd3b99d2f886532',
            'f3d299d9fbd120f8',
            '83c0b3e69e52d157',
            '4c9dcec2d7c19f54',
            'a9115eaab8f64916',
            'bbd81aff0c9329e5',
            '4ef51254356091b0',
            '6ba86e3033e95a73',
            '164acb8c009c61ab',
            '801b2887d56bbb76',
            'e7a6cb81844c685c',
            '9e051f507676260c',
            '7b4f5a1362825796',
            'cdb00a4f9b4b0ed5',
            'ad66c8a995613ada',
            '12a73b5f8ed8205f',
            '0ec7981fe22a06c6',
            '0c3884900dc5694f',
            'de14bdd5b08cb41e',
            '32093313e9fc4e68',
            '7dc66dea3d8c64ea',
            '4b6d90c641d7ba28',
            '75605a6f71e55a14',
            '2dcb8410fe2438f0',
            '063e1bdecd5ce238',
            '2dd2b0f1ecccf91f',
            'f7b112822292d30c',
            '65b57b9fcddc3fa5',
            'fb6f14990eb6c9d2'
        ];

        const narrowVcodes = [
            'f4f849418e3c1ebd',
            'caaf539786a6cd0c',
            'a14b6e55f469896a',
            '7b40a0edcbd8e2a4',
            '4fb6689885fc8ee4',
            '2ff89a16b7d66188',
            '6c3300ace5d18057',
            '1c1498d928667726'
        ];

        // 存储已经使用过的 vcode
        let usedVcodes = new Set();

        // 随机选择 vcode
        function getRandomVcode(vcodeList) {
            let vcode;
            do {
                const randomIndex = Math.floor(Math.random() * vcodeList.length);
                vcode = vcodeList[randomIndex];
            } while (usedVcodes.has(vcode)); // 确保 vcode 没有被使用过
            usedVcodes.add(vcode); // 将 vcode 添加到已使用列表中
            return vcode;
        }

        // 获取目标 div 元素
        let playerDiv = document.getElementById('player_id');

        // 根据宽度和高度的关系设置宽高比和 vcode
        let aspectRatio, vcode;
        if (screenWidth > screenHeight) {
            aspectRatio = 2.25;
            vcode = getRandomVcode(wideVcodes);
        } else {
            aspectRatio = 1 / 1.33;
            vcode = getRandomVcode(narrowVcodes);
        }

        // 更新 div 的 id
        playerDiv.id = `player_${vcode}`;

        // 计算高度
        const height = screenWidth / aspectRatio;

        // 设置宽度和高度
        playerDiv.style.width = `${screenWidth}px`;
        playerDiv.style.height = `${height}px`;

        // 初始化 DogePlayer
        var player = new DogePlayer({
            container: playerDiv,
            userId: 5123,
            vcode: vcode,
            autoPlay: true,
            loop: true,
            volume: 0,
            muted: true,
            vtype: 5,
            switcher: {
                controller: false
            }
        });

        // 监听播放器准备就绪事件
        player.on('play', function() {
            // 获取目标 div 元素
            const heroBackgroundDiv = document.querySelector('article .single_hero_background');
            // 移除 style 属性
            heroBackgroundDiv.removeAttribute('style');
        });
    </script>
  </div>

  <header id="single_header" class="mt-5 max-w-prose">
    {{ if .Params.showBreadcrumbs | default (.Site.Params.article.showBreadcrumbs | default false) }}
    {{ partial "breadcrumbs.html" . }}
    {{ end }}
    <h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">
      {{ .Title }}
    </h1>

    <div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden">
      {{ partial "article-meta/basic.html" (dict "context" . "scope" "single") }}
    </div>

  </header>

  <noscript>
    Please enable JavaScript to view the Media page.
  </noscript>
  <section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row">

      <div class="min-w-0 min-h-0 max-w-fit">

        <div class="article-content max-w-full mb-20">
          {{ .Content }}

          <div class="movies">
            <div class="flex flex-wrap m-auto">
                <span class="category-item bg-neutral-700 text-neutral-100 dark:bg-neutral-100 dark:text-neutral-600 text-sm px-3 py-1 mr-2 mb-2 rounded-sm cursor-pointer hover:bg-neutral-700 hover:text-neutral-100" data-category="all">{{ T `movie_cate_all` | safeHTML }}</span>
                <span class="category-item text-neutral-600 bg-neutral-100 dark:text-neutral-100 dark:bg-neutral-700 text-sm px-3 py-1 mr-2 mb-2 rounded-sm cursor-pointer hover:bg-neutral-700 hover:text-neutral-100 dark:hover:bg-neutral-100 dark:hover:text-neutral-600" data-category="movie">{{ T `movie_cate_movie` | safeHTML }}</span>
                <span class="category-item text-neutral-600 bg-neutral-100 dark:text-neutral-100 dark:bg-neutral-700 text-sm px-3 py-1 mr-2 mb-2 rounded-sm cursor-pointer hover:bg-neutral-700 hover:text-neutral-100 dark:hover:bg-neutral-100 dark:hover:text-neutral-600" data-category="tv">{{ T `movie_cate_tv` | safeHTML }}</span>
                <span class="category-item text-neutral-600 bg-neutral-100 dark:text-neutral-100 dark:bg-neutral-700 text-sm px-3 py-1 mr-2 mb-2 rounded-sm cursor-pointer hover:bg-neutral-700 hover:text-neutral-100 dark:hover:bg-neutral-100 dark:hover:text-neutral-600" data-category="book">{{ T `movie_cate_book` | safeHTML }}</span>
                <span class="category-item text-neutral-600 bg-neutral-100 dark:text-neutral-100 dark:bg-neutral-700 text-sm px-3 py-1 mr-2 mb-2 rounded-sm cursor-pointer hover:bg-neutral-700 hover:text-neutral-100 dark:hover:bg-neutral-100 dark:hover:text-neutral-600" data-category="music">{{ T `movie_cate_music` | safeHTML }}</span>
                <span class="category-item text-neutral-600 bg-neutral-100 dark:text-neutral-100 dark:bg-neutral-700 text-sm px-3 py-1 mr-2 mb-2 rounded-sm cursor-pointer hover:bg-neutral-700 hover:text-neutral-100 dark:hover:bg-neutral-100 dark:hover:text-neutral-600" data-category="game">{{ T `movie_cate_game` | safeHTML }}</span>
                <span class="category-item text-neutral-600 bg-neutral-100 dark:text-neutral-100 dark:bg-neutral-700 text-sm px-3 py-1 mr-2 mb-2 rounded-sm cursor-pointer hover:bg-neutral-700 hover:text-neutral-100 dark:hover:bg-neutral-100 dark:hover:text-neutral-600" data-category="podcast">{{ T `movie_cate_podcast` | safeHTML }}</span>
                <span class="text-neutral-600 bg-neutral-100 dark:text-neutral-100 dark:bg-neutral-700 text-sm px-3 py-1 mr-2 mb-2 rounded-sm cursor-pointer hover:bg-neutral-700 hover:text-neutral-100 dark:hover:bg-neutral-100 dark:hover:text-neutral-600 flex justify-center items-center">{{ partial "icon.html" "random" }} <span class="neodb_random ml-1">今天看什么？（随机）</span></span>
            </div>

            <div class="movie_popup text-sm w-[1024px] max-w-max sm:max-w-fit md:max-w-fit lg:max-w-5xl hidden fixed rounded-md top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-neutral-300 dark:bg-neutral-700 p-5 border border-neutral-300 dark:border-neutral-300 shadow-lg z-50" id="moviePopup">
              <h2 class="flex flex-row items-end mt-2"><a id="movieId" target="_blank" rel="nofollow noopener noreferrer"><div id="movieTitle" class="text-4xl text-gray-500 hover:text-primary-600 dark:hover:text-primary-400 mr-2"></div></a> <span id="randomMovieYear" class="text-xl"></span></h2>
              <div class="flex flex-col lg:flex-row justify-start items-start h-full gap-3">
                <img id="randomMovieCover" src="" alt="Movie Cover" class="self-center max-h-72 md:max-h-80 aspect-[2/3] m-0 p-0 nozoom">
                <div class="flex flex-col leading-8">
                  <div class="flex flex-row items-center mt-0 mb-2 self-start">评分：<div class="flex items-center">
                    <div class="flex items-center relative p-0">
                        <div class="flex items-center"><svg focusable="false" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 256 256" class="flex-shrink-0"><path fill="#ff9800" d="M235.38 98.53A11.82 11.82 0 0 0 225 90.29l-59.45-5.14a4 4 0 0 1-3.32-2.44L139 27.36a11.95 11.95 0 0 0-22.06 0l-23.2 55.35a4 4 0 0 1-3.32 2.44L31 90.29a12 12 0 0 0-6.83 21.07l45.1 39.35a4 4 0 0 1 1.28 4L57 213.22a11.88 11.88 0 0 0 4.67 12.48a11.76 11.76 0 0 0 13.19.53l51.1-31a3.89 3.89 0 0 1 4.08 0l51.1 31a12 12 0 0 0 17.86-13l-13.52-58.54a4 4 0 0 1 1.28-4l45.1-39.35a11.89 11.89 0 0 0 3.52-12.81m-8.78 6.8l-45.1 39.35a12 12 0 0 0-3.82 11.8L191.2 215a4 4 0 0 1-1.56 4.2a3.86 3.86 0 0 1-4.35.17l-51.1-31a11.88 11.88 0 0 0-12.38 0l-51.1 31a3.86 3.86 0 0 1-4.35-.17a4 4 0 0 1-1.56-4.2l13.52-58.54a12 12 0 0 0-3.82-11.8l-45.1-39.33a4 4 0 0 1-1.18-4.33a4 4 0 0 1 3.44-2.75l59.45-5.14a12 12 0 0 0 10-7.31l23.22-55.36a4 4 0 0 1 7.32 0l23.22 55.36a12 12 0 0 0 10 7.31l59.45 5.14a4 4 0 0 1 3.44 2.75a4 4 0 0 1-1.16 4.33"/></svg><svg focusable="false" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 256 256" class="flex-shrink-0"><path fill="#ff9800" d="M235.38 98.53A11.82 11.82 0 0 0 225 90.29l-59.45-5.14a4 4 0 0 1-3.32-2.44L139 27.36a11.95 11.95 0 0 0-22.06 0l-23.2 55.35a4 4 0 0 1-3.32 2.44L31 90.29a12 12 0 0 0-6.83 21.07l45.1 39.35a4 4 0 0 1 1.28 4L57 213.22a11.88 11.88 0 0 0 4.67 12.48a11.76 11.76 0 0 0 13.19.53l51.1-31a3.89 3.89 0 0 1 4.08 0l51.1 31a12 12 0 0 0 17.86-13l-13.52-58.54a4 4 0 0 1 1.28-4l45.1-39.35a11.89 11.89 0 0 0 3.52-12.81m-8.78 6.8l-45.1 39.35a12 12 0 0 0-3.82 11.8L191.2 215a4 4 0 0 1-1.56 4.2a3.86 3.86 0 0 1-4.35.17l-51.1-31a11.88 11.88 0 0 0-12.38 0l-51.1 31a3.86 3.86 0 0 1-4.35-.17a4 4 0 0 1-1.56-4.2l13.52-58.54a12 12 0 0 0-3.82-11.8l-45.1-39.33a4 4 0 0 1-1.18-4.33a4 4 0 0 1 3.44-2.75l59.45-5.14a12 12 0 0 0 10-7.31l23.22-55.36a4 4 0 0 1 7.32 0l23.22 55.36a12 12 0 0 0 10 7.31l59.45 5.14a4 4 0 0 1 3.44 2.75a4 4 0 0 1-1.16 4.33"/></svg><svg focusable="false" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 256 256" class="flex-shrink-0"><path fill="#ff9800" d="M235.38 98.53A11.82 11.82 0 0 0 225 90.29l-59.45-5.14a4 4 0 0 1-3.32-2.44L139 27.36a11.95 11.95 0 0 0-22.06 0l-23.2 55.35a4 4 0 0 1-3.32 2.44L31 90.29a12 12 0 0 0-6.83 21.07l45.1 39.35a4 4 0 0 1 1.28 4L57 213.22a11.88 11.88 0 0 0 4.67 12.48a11.76 11.76 0 0 0 13.19.53l51.1-31a3.89 3.89 0 0 1 4.08 0l51.1 31a12 12 0 0 0 17.86-13l-13.52-58.54a4 4 0 0 1 1.28-4l45.1-39.35a11.89 11.89 0 0 0 3.52-12.81m-8.78 6.8l-45.1 39.35a12 12 0 0 0-3.82 11.8L191.2 215a4 4 0 0 1-1.56 4.2a3.86 3.86 0 0 1-4.35.17l-51.1-31a11.88 11.88 0 0 0-12.38 0l-51.1 31a3.86 3.86 0 0 1-4.35-.17a4 4 0 0 1-1.56-4.2l13.52-58.54a12 12 0 0 0-3.82-11.8l-45.1-39.33a4 4 0 0 1-1.18-4.33a4 4 0 0 1 3.44-2.75l59.45-5.14a12 12 0 0 0 10-7.31l23.22-55.36a4 4 0 0 1 7.32 0l23.22 55.36a12 12 0 0 0 10 7.31l59.45 5.14a4 4 0 0 1 3.44 2.75a4 4 0 0 1-1.16 4.33"/></svg><svg focusable="false" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 256 256" class="flex-shrink-0"><path fill="#ff9800" d="M235.38 98.53A11.82 11.82 0 0 0 225 90.29l-59.45-5.14a4 4 0 0 1-3.32-2.44L139 27.36a11.95 11.95 0 0 0-22.06 0l-23.2 55.35a4 4 0 0 1-3.32 2.44L31 90.29a12 12 0 0 0-6.83 21.07l45.1 39.35a4 4 0 0 1 1.28 4L57 213.22a11.88 11.88 0 0 0 4.67 12.48a11.76 11.76 0 0 0 13.19.53l51.1-31a3.89 3.89 0 0 1 4.08 0l51.1 31a12 12 0 0 0 17.86-13l-13.52-58.54a4 4 0 0 1 1.28-4l45.1-39.35a11.89 11.89 0 0 0 3.52-12.81m-8.78 6.8l-45.1 39.35a12 12 0 0 0-3.82 11.8L191.2 215a4 4 0 0 1-1.56 4.2a3.86 3.86 0 0 1-4.35.17l-51.1-31a11.88 11.88 0 0 0-12.38 0l-51.1 31a3.86 3.86 0 0 1-4.35-.17a4 4 0 0 1-1.56-4.2l13.52-58.54a12 12 0 0 0-3.82-11.8l-45.1-39.33a4 4 0 0 1-1.18-4.33a4 4 0 0 1 3.44-2.75l59.45-5.14a12 12 0 0 0 10-7.31l23.22-55.36a4 4 0 0 1 7.32 0l23.22 55.36a12 12 0 0 0 10 7.31l59.45 5.14a4 4 0 0 1 3.44 2.75a4 4 0 0 1-1.16 4.33"/></svg><svg focusable="false" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 256 256" class="flex-shrink-0"><path fill="#ff9800" d="M235.38 98.53A11.82 11.82 0 0 0 225 90.29l-59.45-5.14a4 4 0 0 1-3.32-2.44L139 27.36a11.95 11.95 0 0 0-22.06 0l-23.2 55.35a4 4 0 0 1-3.32 2.44L31 90.29a12 12 0 0 0-6.83 21.07l45.1 39.35a4 4 0 0 1 1.28 4L57 213.22a11.88 11.88 0 0 0 4.67 12.48a11.76 11.76 0 0 0 13.19.53l51.1-31a3.89 3.89 0 0 1 4.08 0l51.1 31a12 12 0 0 0 17.86-13l-13.52-58.54a4 4 0 0 1 1.28-4l45.1-39.35a11.89 11.89 0 0 0 3.52-12.81m-8.78 6.8l-45.1 39.35a12 12 0 0 0-3.82 11.8L191.2 215a4 4 0 0 1-1.56 4.2a3.86 3.86 0 0 1-4.35.17l-51.1-31a11.88 11.88 0 0 0-12.38 0l-51.1 31a3.86 3.86 0 0 1-4.35-.17a4 4 0 0 1-1.56-4.2l13.52-58.54a12 12 0 0 0-3.82-11.8l-45.1-39.33a4 4 0 0 1-1.18-4.33a4 4 0 0 1 3.44-2.75l59.45-5.14a12 12 0 0 0 10-7.31l23.22-55.36a4 4 0 0 1 7.32 0l23.22 55.36a12 12 0 0 0 10 7.31l59.45 5.14a4 4 0 0 1 3.44 2.75a4 4 0 0 1-1.16 4.33"/></svg></div>
                        <div id="ratingWidth" class="flex items-center overflow-hidden absolute top-0"><svg focusable="false" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 256 256" class="flex-shrink-0"><path fill="#ff9800" d="m234.5 114.38l-45.1 39.36l13.51 58.6a16 16 0 0 1-23.84 17.34l-51.11-31l-51 31a16 16 0 0 1-23.84-17.34l13.49-58.54l-45.11-39.42a16 16 0 0 1 9.11-28.06l59.46-5.15l23.21-55.36a15.95 15.95 0 0 1 29.44 0L166 81.17l59.44 5.15a16 16 0 0 1 9.11 28.06Z"/></svg><svg focusable="false" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 256 256" class="flex-shrink-0"><path fill="#ff9800" d="m234.5 114.38l-45.1 39.36l13.51 58.6a16 16 0 0 1-23.84 17.34l-51.11-31l-51 31a16 16 0 0 1-23.84-17.34l13.49-58.54l-45.11-39.42a16 16 0 0 1 9.11-28.06l59.46-5.15l23.21-55.36a15.95 15.95 0 0 1 29.44 0L166 81.17l59.44 5.15a16 16 0 0 1 9.11 28.06Z"/></svg><svg focusable="false" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 256 256" class="flex-shrink-0"><path fill="#ff9800" d="m234.5 114.38l-45.1 39.36l13.51 58.6a16 16 0 0 1-23.84 17.34l-51.11-31l-51 31a16 16 0 0 1-23.84-17.34l13.49-58.54l-45.11-39.42a16 16 0 0 1 9.11-28.06l59.46-5.15l23.21-55.36a15.95 15.95 0 0 1 29.44 0L166 81.17l59.44 5.15a16 16 0 0 1 9.11 28.06Z"/></svg><svg focusable="false" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 256 256" class="flex-shrink-0"><path fill="#ff9800" d="m234.5 114.38l-45.1 39.36l13.51 58.6a16 16 0 0 1-23.84 17.34l-51.11-31l-51 31a16 16 0 0 1-23.84-17.34l13.49-58.54l-45.11-39.42a16 16 0 0 1 9.11-28.06l59.46-5.15l23.21-55.36a15.95 15.95 0 0 1 29.44 0L166 81.17l59.44 5.15a16 16 0 0 1 9.11 28.06Z"/></svg><svg focusable="false" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 256 256" class="flex-shrink-0"><path fill="#ff9800" d="m234.5 114.38l-45.1 39.36l13.51 58.6a16 16 0 0 1-23.84 17.34l-51.11-31l-51 31a16 16 0 0 1-23.84-17.34l13.49-58.54l-45.11-39.42a16 16 0 0 1 9.11-28.06l59.46-5.15l23.21-55.36a15.95 15.95 0 0 1 29.44 0L166 81.17l59.44 5.15a16 16 0 0 1 9.11 28.06Z"/></svg></div>
                    </div>
                    <span id="randomMovieRating" class="text-sm hover:text-neutral-100 text-[#ff9800] ml-1"></span>
                    <span class="text-sm hover:text-neutral-100 text-[#ff9800] ml-1">(<span id="randomMovieRatingCount"></span>)</span>
                    </div>
                  </div>
                  <p class="my-2 hidden sm:flex"><span class="whitespace-nowrap self-start">又名：</span><span id="otherTitle"></span></p>
                  <p class="my-2 hidden sm:flex"><span class="whitespace-nowrap self-start">分类：</span><span id="randomMovieGenre"></span></p>
                  <p class="my-2 hidden sm:flex"><span class="whitespace-nowrap self-start">导演：</span><span id="movieDirector"></span></p>
                  <p class="my-2 hidden sm:flex"><span class="whitespace-nowrap self-start">主演：</span><span id="movieActor"></span></p>
                  <p class="mt-2 mb-0 hidden lg:flex"><span class="whitespace-nowrap leading-5 self-start">倒计时：</span><span class="text-sm">随机影片功能有冷却时间，不能无限随机，倒记时冷却时长为随机的影片时长。倒计时结束后，可随机一部新影片。<span id="countdown"></span></p>
                </div>
              </div>
              <p class="hidden lg:flex"><span class="whitespace-nowrap">简介：</span><span id="movieDescription"></span></p>
              <div class="flex justify-center">
                <button id="closePopup" class="rounded-md bg-neutral-800 py-2 px-4 border border-transparent text-center text-sm text-neutral-100 transition-all shadow-md hover:shadow-lg focus:bg-neutral-700 focus:shadow-none active:bg-neutral-700 hover:bg-neutral-700 active:shadow-none disabled:pointer-events-none disabled:opacity-50 disabled:shadow-none ml-2" type="button">关闭</button>
              </div>
          </div>

            <div class="grid gap-1.5 grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 mt-4 w-full">

                {{ $moviesResource := resources.Get "data/neodb/movie.json" }}
                {{ $movies := $moviesResource | transform.Unmarshal }}
                {{ range $movies.data }}
                    {{ $title := .item.title }}
                    {{ $localizedTitles := .item.localized_title }}
                    {{ $orig_title := (index (where $localizedTitles "lang" "en") 0).text }}
                    {{ $rating := float .item.rating }}
                    {{ $rating_percent := mul $rating 10 }}
                    {{ $rating_count := .item.rating_count }}
                    {{ $movie_url := printf "https://neodb.social%s" .item.url }}
                    {{ $id := .item.id }}
                    {{ $cover := .item.cover_image_url }}
                    {{ $cover_name := path.Base $cover }}
                    {{ $movieCover := printf "images/neodb/cover/%s" $cover_name }}
                    {{ $brief := .item.brief }}
                    {{ $category  := .item.category }}
                    {{ $comment_text := .comment_text }}
                    {{ $type := .item.type }}

                <div class="card m-cate-{{ $category }} group relative overflow-hidden rounded aspect-[2/3]">
                    <div class="relative overflow-hidden w-full pb-150 before:absolute before:h-full before:w-full before:left-0 before:-z-10 before:duration-500 before:-bottom-40 group-hover:before:bottom-0 group-hover:before:bg-gradient-to-b group-hover:before:from-transparent group-hover:before:from-60% group-hover:before:to-[var(--media-bg-color-cover)] group-hover:before:to-100% group-hover:before:z-10">
                        {{ with resources.Get $movieCover }}
                            {{ with .Resize "256x webp" }}
                                <img alt="{{- $title -}}" class="lazy nozoom absolute top-0 left-0 w-full h-full object-cover mt-0 mb-0 duration-500 group-hover:blur group-hover:brightness-75 group-hover:-translate-y-2" loading="lazy" src="/assets/images/movie/cover.png" data-src="{{ .RelPermalink }}" no-view>
                            {{ end }}
                        {{ end }}
                    </div>
                    <div class="absolute flex items-center gap-1 top-0 right-0 bg-yellow-600 italic capitalize opacity-0 text-neutral text-sm px-2 py-px rounded-bl-lg group-hover:opacity-100 transition-all duration-500 ease-in-out">
                        {{- if eq $category "movie" -}}
                            {{ partial "icon.html" "film" }} Film
                        {{- else if eq $category "book" -}}
                            {{ partial "icon.html" "book" }} Book
                        {{- else if eq $category "tv" -}}
                            {{ partial "icon.html" "tv" }} TV
                        {{- else if eq $category "music" -}}
                            {{ partial "icon.html" "music" }} Music
                        {{- else if eq $category "game" -}}
                            {{ partial "icon.html" "steam" }} Game
                        {{- else if eq $category "podcast" -}}
                            {{ partial "icon.html" "podcast" }} Podcast
                        {{- else if eq $category "album" -}}
                            {{ partial "icon.html" "images" }} Album
                        {{- else if eq $category "performance" -}}
                            {{ partial "icon.html" "database" }} Performance
                        {{- else -}}
                            {{ partial "icon.html" "database" }} NeoDB
                        {{- end -}}
                    </div>
                    <div class="flex flex-col items-start justify-end absolute p-2 w-full h-fit box-border left-0 -bottom-96 transition-all duration-400 ease-in z-10 group-hover:bottom-0">
                        <h2 class="m-0 p-0 text-lg md:text-xl">
                            <a href="/go/?target={{- $id | base64Encode -}}" target="_blank" class="block text-neutral text-shadow-hover-white m-0 p-0" rel="noreferrer noopener nofollow">{{- $title -}}</a>
                        </h2>

                        <div class="block text-neutral-200 hover:text-primary-600 text-shadow-hover-white text-sm m-0 p-0">{{- $orig_title | default $title -}}</div>

                        <div class="flex items-center mt-1">
                            <div class="flex items-center relative p-0">
                                <div class="flex items-center"><svg focusable="false" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 256 256" class="flex-shrink-0"><path fill="#ff9800" d="M235.38 98.53A11.82 11.82 0 0 0 225 90.29l-59.45-5.14a4 4 0 0 1-3.32-2.44L139 27.36a11.95 11.95 0 0 0-22.06 0l-23.2 55.35a4 4 0 0 1-3.32 2.44L31 90.29a12 12 0 0 0-6.83 21.07l45.1 39.35a4 4 0 0 1 1.28 4L57 213.22a11.88 11.88 0 0 0 4.67 12.48a11.76 11.76 0 0 0 13.19.53l51.1-31a3.89 3.89 0 0 1 4.08 0l51.1 31a12 12 0 0 0 17.86-13l-13.52-58.54a4 4 0 0 1 1.28-4l45.1-39.35a11.89 11.89 0 0 0 3.52-12.81m-8.78 6.8l-45.1 39.35a12 12 0 0 0-3.82 11.8L191.2 215a4 4 0 0 1-1.56 4.2a3.86 3.86 0 0 1-4.35.17l-51.1-31a11.88 11.88 0 0 0-12.38 0l-51.1 31a3.86 3.86 0 0 1-4.35-.17a4 4 0 0 1-1.56-4.2l13.52-58.54a12 12 0 0 0-3.82-11.8l-45.1-39.33a4 4 0 0 1-1.18-4.33a4 4 0 0 1 3.44-2.75l59.45-5.14a12 12 0 0 0 10-7.31l23.22-55.36a4 4 0 0 1 7.32 0l23.22 55.36a12 12 0 0 0 10 7.31l59.45 5.14a4 4 0 0 1 3.44 2.75a4 4 0 0 1-1.16 4.33"/></svg><svg focusable="false" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 256 256" class="flex-shrink-0"><path fill="#ff9800" d="M235.38 98.53A11.82 11.82 0 0 0 225 90.29l-59.45-5.14a4 4 0 0 1-3.32-2.44L139 27.36a11.95 11.95 0 0 0-22.06 0l-23.2 55.35a4 4 0 0 1-3.32 2.44L31 90.29a12 12 0 0 0-6.83 21.07l45.1 39.35a4 4 0 0 1 1.28 4L57 213.22a11.88 11.88 0 0 0 4.67 12.48a11.76 11.76 0 0 0 13.19.53l51.1-31a3.89 3.89 0 0 1 4.08 0l51.1 31a12 12 0 0 0 17.86-13l-13.52-58.54a4 4 0 0 1 1.28-4l45.1-39.35a11.89 11.89 0 0 0 3.52-12.81m-8.78 6.8l-45.1 39.35a12 12 0 0 0-3.82 11.8L191.2 215a4 4 0 0 1-1.56 4.2a3.86 3.86 0 0 1-4.35.17l-51.1-31a11.88 11.88 0 0 0-12.38 0l-51.1 31a3.86 3.86 0 0 1-4.35-.17a4 4 0 0 1-1.56-4.2l13.52-58.54a12 12 0 0 0-3.82-11.8l-45.1-39.33a4 4 0 0 1-1.18-4.33a4 4 0 0 1 3.44-2.75l59.45-5.14a12 12 0 0 0 10-7.31l23.22-55.36a4 4 0 0 1 7.32 0l23.22 55.36a12 12 0 0 0 10 7.31l59.45 5.14a4 4 0 0 1 3.44 2.75a4 4 0 0 1-1.16 4.33"/></svg><svg focusable="false" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 256 256" class="flex-shrink-0"><path fill="#ff9800" d="M235.38 98.53A11.82 11.82 0 0 0 225 90.29l-59.45-5.14a4 4 0 0 1-3.32-2.44L139 27.36a11.95 11.95 0 0 0-22.06 0l-23.2 55.35a4 4 0 0 1-3.32 2.44L31 90.29a12 12 0 0 0-6.83 21.07l45.1 39.35a4 4 0 0 1 1.28 4L57 213.22a11.88 11.88 0 0 0 4.67 12.48a11.76 11.76 0 0 0 13.19.53l51.1-31a3.89 3.89 0 0 1 4.08 0l51.1 31a12 12 0 0 0 17.86-13l-13.52-58.54a4 4 0 0 1 1.28-4l45.1-39.35a11.89 11.89 0 0 0 3.52-12.81m-8.78 6.8l-45.1 39.35a12 12 0 0 0-3.82 11.8L191.2 215a4 4 0 0 1-1.56 4.2a3.86 3.86 0 0 1-4.35.17l-51.1-31a11.88 11.88 0 0 0-12.38 0l-51.1 31a3.86 3.86 0 0 1-4.35-.17a4 4 0 0 1-1.56-4.2l13.52-58.54a12 12 0 0 0-3.82-11.8l-45.1-39.33a4 4 0 0 1-1.18-4.33a4 4 0 0 1 3.44-2.75l59.45-5.14a12 12 0 0 0 10-7.31l23.22-55.36a4 4 0 0 1 7.32 0l23.22 55.36a12 12 0 0 0 10 7.31l59.45 5.14a4 4 0 0 1 3.44 2.75a4 4 0 0 1-1.16 4.33"/></svg><svg focusable="false" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 256 256" class="flex-shrink-0"><path fill="#ff9800" d="M235.38 98.53A11.82 11.82 0 0 0 225 90.29l-59.45-5.14a4 4 0 0 1-3.32-2.44L139 27.36a11.95 11.95 0 0 0-22.06 0l-23.2 55.35a4 4 0 0 1-3.32 2.44L31 90.29a12 12 0 0 0-6.83 21.07l45.1 39.35a4 4 0 0 1 1.28 4L57 213.22a11.88 11.88 0 0 0 4.67 12.48a11.76 11.76 0 0 0 13.19.53l51.1-31a3.89 3.89 0 0 1 4.08 0l51.1 31a12 12 0 0 0 17.86-13l-13.52-58.54a4 4 0 0 1 1.28-4l45.1-39.35a11.89 11.89 0 0 0 3.52-12.81m-8.78 6.8l-45.1 39.35a12 12 0 0 0-3.82 11.8L191.2 215a4 4 0 0 1-1.56 4.2a3.86 3.86 0 0 1-4.35.17l-51.1-31a11.88 11.88 0 0 0-12.38 0l-51.1 31a3.86 3.86 0 0 1-4.35-.17a4 4 0 0 1-1.56-4.2l13.52-58.54a12 12 0 0 0-3.82-11.8l-45.1-39.33a4 4 0 0 1-1.18-4.33a4 4 0 0 1 3.44-2.75l59.45-5.14a12 12 0 0 0 10-7.31l23.22-55.36a4 4 0 0 1 7.32 0l23.22 55.36a12 12 0 0 0 10 7.31l59.45 5.14a4 4 0 0 1 3.44 2.75a4 4 0 0 1-1.16 4.33"/></svg><svg focusable="false" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 256 256" class="flex-shrink-0"><path fill="#ff9800" d="M235.38 98.53A11.82 11.82 0 0 0 225 90.29l-59.45-5.14a4 4 0 0 1-3.32-2.44L139 27.36a11.95 11.95 0 0 0-22.06 0l-23.2 55.35a4 4 0 0 1-3.32 2.44L31 90.29a12 12 0 0 0-6.83 21.07l45.1 39.35a4 4 0 0 1 1.28 4L57 213.22a11.88 11.88 0 0 0 4.67 12.48a11.76 11.76 0 0 0 13.19.53l51.1-31a3.89 3.89 0 0 1 4.08 0l51.1 31a12 12 0 0 0 17.86-13l-13.52-58.54a4 4 0 0 1 1.28-4l45.1-39.35a11.89 11.89 0 0 0 3.52-12.81m-8.78 6.8l-45.1 39.35a12 12 0 0 0-3.82 11.8L191.2 215a4 4 0 0 1-1.56 4.2a3.86 3.86 0 0 1-4.35.17l-51.1-31a11.88 11.88 0 0 0-12.38 0l-51.1 31a3.86 3.86 0 0 1-4.35-.17a4 4 0 0 1-1.56-4.2l13.52-58.54a12 12 0 0 0-3.82-11.8l-45.1-39.33a4 4 0 0 1-1.18-4.33a4 4 0 0 1 3.44-2.75l59.45-5.14a12 12 0 0 0 10-7.31l23.22-55.36a4 4 0 0 1 7.32 0l23.22 55.36a12 12 0 0 0 10 7.31l59.45 5.14a4 4 0 0 1 3.44 2.75a4 4 0 0 1-1.16 4.33"/></svg></div>
                                <div class="flex items-center overflow-hidden absolute top-0" style="width: {{- $rating_percent -}}%;"><svg focusable="false" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 256 256" class="flex-shrink-0"><path fill="#ff9800" d="m234.5 114.38l-45.1 39.36l13.51 58.6a16 16 0 0 1-23.84 17.34l-51.11-31l-51 31a16 16 0 0 1-23.84-17.34l13.49-58.54l-45.11-39.42a16 16 0 0 1 9.11-28.06l59.46-5.15l23.21-55.36a15.95 15.95 0 0 1 29.44 0L166 81.17l59.44 5.15a16 16 0 0 1 9.11 28.06Z"/></svg><svg focusable="false" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 256 256" class="flex-shrink-0"><path fill="#ff9800" d="m234.5 114.38l-45.1 39.36l13.51 58.6a16 16 0 0 1-23.84 17.34l-51.11-31l-51 31a16 16 0 0 1-23.84-17.34l13.49-58.54l-45.11-39.42a16 16 0 0 1 9.11-28.06l59.46-5.15l23.21-55.36a15.95 15.95 0 0 1 29.44 0L166 81.17l59.44 5.15a16 16 0 0 1 9.11 28.06Z"/></svg><svg focusable="false" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 256 256" class="flex-shrink-0"><path fill="#ff9800" d="m234.5 114.38l-45.1 39.36l13.51 58.6a16 16 0 0 1-23.84 17.34l-51.11-31l-51 31a16 16 0 0 1-23.84-17.34l13.49-58.54l-45.11-39.42a16 16 0 0 1 9.11-28.06l59.46-5.15l23.21-55.36a15.95 15.95 0 0 1 29.44 0L166 81.17l59.44 5.15a16 16 0 0 1 9.11 28.06Z"/></svg><svg focusable="false" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 256 256" class="flex-shrink-0"><path fill="#ff9800" d="m234.5 114.38l-45.1 39.36l13.51 58.6a16 16 0 0 1-23.84 17.34l-51.11-31l-51 31a16 16 0 0 1-23.84-17.34l13.49-58.54l-45.11-39.42a16 16 0 0 1 9.11-28.06l59.46-5.15l23.21-55.36a15.95 15.95 0 0 1 29.44 0L166 81.17l59.44 5.15a16 16 0 0 1 9.11 28.06Z"/></svg><svg focusable="false" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 256 256" class="flex-shrink-0"><path fill="#ff9800" d="m234.5 114.38l-45.1 39.36l13.51 58.6a16 16 0 0 1-23.84 17.34l-51.11-31l-51 31a16 16 0 0 1-23.84-17.34l13.49-58.54l-45.11-39.42a16 16 0 0 1 9.11-28.06l59.46-5.15l23.21-55.36a15.95 15.95 0 0 1 29.44 0L166 81.17l59.44 5.15a16 16 0 0 1 9.11 28.06Z"/></svg></div>
                            </div>
                            <span class="text-xs text-neutral-100 hover:text-[#ff9800] ml-1">{{- $rating | default "Null" -}}</span>
                        </div>


                        <div class="w-full relative mt-1 hidden md:flex flex-nowrap overflow-hidden gap-1">
                          {{ with $type }}
                            <span class="mt-0 inline-block whitespace-nowrap rounded text-white capitalize p-1 text-xs text-neutral-200 bg-neutral-700">{{- . -}}</span>
                          {{ end }}
                          {{ with $rating_count }}
                          <span class="mt-0 inline-block whitespace-nowrap rounded text-white capitalize p-1 text-xs text-neutral-200 bg-neutral-700">{{- . -}}&nbsp;人点评</span>
                          {{ end }}
                        </div>

                        <div class="overflow-hidden my-2">
                            {{ if $comment_text }}
                                <p class="text-xs m-0 text-neutral-100 line-clamp-3">短评：{{ $comment_text }}</p>
                            {{ else }}
                                <p class="text-xs m-0 text-neutral-100 line-clamp-3">简介：{{ $brief }}</p>
                            {{ end }}
                        </div>
                        <div class="w-full flex justify-start items-center">
                            <div class="relative flex items-center">
                                <h4></h4>
                                <ul class="pl-0 p-0 m-0 flex space-x-[-10px]">
                                    <li class="neodb w-6 h-6 overflow-hidden pl-0 rounded-full list-none border-2 border-solid border-neutral">
                                        <a href="/go/?target={{- $id | base64Encode -}}" target="_blank" class="flex" rel="noreferrer noopener nofollow">
                                            <img src="/assets/images/movie/neodbsocial.jpg" class="nozoom m-0" loading="lazy" alt="NeoDB" no-view>
                                        </a>
                                    </li>
                                      {{ range .item.external_resources }}
                                      {{ $parsedURL := urls.Parse .url }}
                                      {{ $host := $parsedURL.Hostname }}
                                        {{ if not (or (strings.Contains .url "minreol.dk") (strings.Contains .url "eggplant.place")) }}
                                            {{ if eq $host "books.google.com" }}
                                                  <li class="external-resource w-6 h-6 overflow-hidden pl-0 rounded-full list-none border-2 border-solid border-neutral">
                                                      <a href="/go/?target={{- .url | base64Encode -}}" target="_blank" class="flex" rel="noreferrer noopener nofollow">
                                                          <img src="/assets/images/movie/google-books.png" class="nozoom m-0" loading="lazy" alt="{{- $title -}}" no-view>
                                                      </a>
                                                  </li>
                                              {{ else }}
                                                  <li class="external-resource w-6 h-6 overflow-hidden pl-0 rounded-full list-none border-2 border-solid border-neutral">
                                                      <a href="/go/?target={{- .url | base64Encode -}}" target="_blank" class="flex" rel="noreferrer noopener nofollow">
                                                          <img src="/assets/images/movie/{{- $host -}}.png" class="nozoom m-0" loading="lazy" alt="{{- $title -}}" no-view>
                                                      </a>
                                                  </li>
                                              {{ end }}
                                        {{ end }}
                                      {{ end }}
                                </ul>
                            </div>
                            <div class="flex items-center pr-2 before:relative before:text-neutral-600 before:mx-1 before:content-['|'] before:text-xs">
                                {{ $cleanedTitle := replaceRE `^(.*?)\s+(第[一二三四五六七八九十0-9]+季).*` "$1" $title }}
                                {{- if eq $category "movie" -}}
                                    <a href="https://v.eallion.com/search?box={{- $cleanedTitle -}}" target="_blank" rel="noreferrer noopener nofollow" aria-label="play" alt="在线播放" title="在线播放">
                                        <svg t="1726385597981" class="" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="7184" width="28" height="28"><path d="M113.92 98.450286v54.857143h80.457143v-54.857143h435.2v54.857143h80.457143v-54.857143h25.6c14.628571 0 25.6 10.971429 25.6 25.6v332.8c-18.285714-3.657143-36.571429-7.314286-54.857143-7.314286v-43.885714c0-3.657143 0-7.314286-3.657143-7.314286s-3.657143-3.657143-7.314286-3.657143h-51.2c-7.314286 0-10.971429 3.657143-10.971428 10.971429v54.857143c-95.085714 29.257143-164.571429 120.685714-164.571429 226.742857 0 21.942857 3.657143 43.885714 10.971429 65.828571h-281.6v-25.6h-84.114286v25.6h-29.257143c-14.628571 0-25.6-10.971429-25.6-25.6v-603.428571c0-14.628571 10.971429-25.6 25.6-25.6h29.257143z m69.485714 460.8h-58.514285c-3.657143 0-7.314286 0-7.314286 3.657143-3.657143 3.657143-3.657143 3.657143-3.657143 7.314285v58.514286c0 3.657143 0 7.314286 3.657143 7.314286 3.657143 3.657143 3.657143 3.657143 7.314286 3.657143h58.514285c7.314286 0 10.971429-3.657143 10.971429-10.971429v-58.514286c0-3.657143 0-7.314286-3.657143-7.314285 0-3.657143-3.657143-3.657143-7.314286-3.657143z m179.2-259.657143c-7.314286-3.657143-14.628571-3.657143-18.285714 0-7.314286 7.314286-10.971429 10.971429-10.971429 18.285714v208.457143c0 7.314286 3.657143 14.628571 10.971429 18.285714 3.657143 3.657143 7.314286 3.657143 10.971429 3.657143 3.657143 0 7.314286 0 10.971428-3.657143l175.542857-102.4c7.314286-3.657143 10.971429-10.971429 10.971429-18.285714s-3.657143-14.628571-10.971429-18.285714l-179.2-106.057143z m-179.2 95.085714h-58.514285c-3.657143 0-7.314286 0-7.314286 3.657143-3.657143 3.657143-3.657143 3.657143-3.657143 7.314286v58.514285c0 3.657143 0 7.314286 3.657143 7.314286 3.657143 3.657143 3.657143 3.657143 7.314286 3.657143h58.514285c7.314286 0 10.971429-3.657143 10.971429-10.971429v-58.514285c0-3.657143 0-7.314286-3.657143-7.314286s-3.657143-3.657143-7.314286-3.657143z m0-164.571428h-58.514285c-3.657143 0-7.314286 0-7.314286 3.657142-3.657143 3.657143-3.657143 7.314286-3.657143 10.971429v58.514286c0 3.657143 0 7.314286 3.657143 7.314285 3.657143 3.657143 3.657143 3.657143 7.314286 3.657143h58.514285c3.657143 0 7.314286 0 7.314286-3.657143 3.657143-3.657143 3.657143-3.657143 3.657143-7.314285v-58.514286c0-3.657143 0-7.314286-3.657143-7.314286 0-3.657143-3.657143-7.314286-7.314286-7.314285z m519.314286 0h-58.514286c-7.314286 0-10.971429 3.657143-10.971428 10.971428v58.514286c0 7.314286 3.657143 10.971429 10.971428 10.971428h58.514286c3.657143 0 7.314286 0 7.314286-3.657142 3.657143-3.657143 3.657143-3.657143 3.657143-7.314286v-54.857143c0-3.657143 0-7.314286-3.657143-7.314286-3.657143-3.657143-3.657143-7.314286-7.314286-7.314285z" fill="#ffffff" p-id="7185"></path><path d="M582.875429 563.2c69.485714-69.485714 182.857143-69.485714 256 0 62.171429 62.171429 69.485714 160.914286 18.285714 230.4 3.657143 3.657143 3.657143 3.657143 3.657143 7.314286l65.828571 73.142857c10.971429 10.971429 10.971429 29.257143-3.657143 40.228571-10.971429 10.971429-29.257143 10.971429-40.228571-3.657143l-65.828572-73.142857c-69.485714 51.2-168.228571 43.885714-230.4-18.285714-73.142857-69.485714-73.142857-182.857143-3.657142-256z m223.085714 36.571429c-36.571429-36.571429-95.085714-47.542857-142.628572-29.257143s-84.114286 69.485714-84.114285 120.685714 32.914286 102.4 80.457143 120.685714 106.057143 7.314286 142.628571-29.257143c25.6-25.6 40.228571-58.514286 40.228571-91.428571s-14.628571-69.485714-36.571428-91.428571z" fill="#ffffff" p-id="7186"></path></svg>
                                    </a>
                                {{- else if eq $category "book" -}}
                                    <a href="https://annas-archive.org/search?q={{- $title -}}" target="_blank" rel="noreferrer noopener nofollow" aria-label="play" alt="在线阅读" title="在线阅读">
                                        <svg t="1709798084149" class="" viewBox="0 0 1105 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5377" width="28" height="28"><path d="M647.064511 471.633702a196.014298 196.014298 0 0 0 39.69634-118.277447c0-107.563574-86.440851-194.875915-193.187404-194.875915-106.63217 0-193.187404 87.192511-193.187404 194.875915 0 107.569021 86.440851 194.875915 193.187404 194.875915a191.400851 191.400851 0 0 0 108.712851-33.759319l37.621106 37.953362a30.464 30.464 0 0 0 29.777702 8.034042 31.193872 31.193872 0 0 0 21.809022-22.005106 31.297362 31.297362 0 0 0-7.963234-30.033702l-36.466383-36.787745zM828.889872 833.361702H294.040511c-20.806809 0-38.040511-20.834043-38.040511-46.297872 0-25.32766 17.119319-46.297872 38.040511-46.297873h534.849361c20.812255 0 38.045957 20.834043 38.045958 46.297873 0.669957 25.32766-16.558298 46.297872-38.045958 46.297872z m142.107234-691.537702c24.167489 1.454298 31.21566 17.102979 31.21566 37.893447v741.027404c-1.230979 19.118298-15.550638 37.893447-41.286809 37.893447H218.068426C154.961702 958.638298 103.489362 907.220426 103.489362 844.16817V179.83183C103.489362 116.779574 154.961702 65.361702 218.068426 65.361702H768c84.425532 0 100.765957 89.87234 100.765957 114.382979 0 16.340426-0.386723 169.363064-1.16017 459.073362 0 20.795915-17.119319 38.00783-38.045957 38.007829H218.068426c-20.812255 0-37.931574 17.102979-37.931575 37.898894v130.113362c0 20.795915 17.119319 37.898894 37.931575 37.898893h672.571914a49.021277 49.021277 0 0 0 49.021277-49.021276V179.826383c0-20.790468 8.170213-37.332426 31.335489-38.002383z m-477.249361 343.464851c-72.192 0-130.723404-58.531404-130.723405-130.723404s58.531404-130.723404 130.723405-130.723404 130.723404 58.531404 130.723404 130.723404-58.531404 130.723404-130.723404 130.723404z" fill="#ffffff" p-id="5378"></path></svg>
                                    </a>
                                {{- else if eq $category "tv" -}}
                                    <a href="https://v.eallion.com/search?box={{- $cleanedTitle -}}" target="_blank" rel="noreferrer noopener nofollow" aria-label="play" alt="在线播放" title="在线播放">
                                        <svg t="1726385454737" class="" viewBox="0 0 1038 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="6912" width="26" height="26"><path d="M959.362975 972.397288a46.392869 46.392869 0 0 1-32.198035 13.640888 44.107847 44.107847 0 0 1-32.128793-13.640888l-85.099754-82.953219 21.257628-21.811572 84.545809 82.953218a15.579695 15.579695 0 0 0 21.811573 0 15.510452 15.510452 0 0 0 4.362314-10.940407 15.233479 15.233479 0 0 0-4.362314-10.871165l-82.330031-85.722942 21.811572-21.257628 82.330031 85.653699a45.008007 45.008007 0 0 1 13.086944 32.198036 47.77773 47.77773 0 0 1-13.086944 32.75198zM305.431258 238.489805l305.431259 152.196306-305.431259 152.265549V238.489805z m377.998014 655.870523a194.919291 194.919291 0 0 1-104.07236-30.536201c3.600641 2.146536 6.50885 5.123988 10.247977 7.062795h-354.524607v-70.350977h277.041592c13.917861 21.811573 32.890466 39.191587 53.871122 54.009608A199.489335 199.489335 0 0 1 485.394042 694.663264c0-110.234995 88.908124-199.697064 198.03523-199.697063 42.999957 0 82.53776 14.264076 115.082011 37.875968V98.20331H70.350977v562.04614h412.342585c-1.661834 10.386463-2.70048 21.326871-2.70048 32.198036 0 12.602242 1.592591 25.689185 3.808369 37.114294H46.87757c-20.149738 0-46.87757-26.727832-46.87757-46.946813V63.858739C0 43.639757 16.341369 27.298388 36.56035 27.298388H832.30191a37.391267 37.391267 0 0 1 36.56035 37.114295v562.392356c7.61674 21.257628 12.532999 43.900117 12.532999 67.858225 0 110.234995-88.908124 199.697064-197.965987 199.697064zM515.930244 694.663264a168.468432 168.468432 0 0 0 167.499028 168.606918c92.162549 0 167.429785-75.821181 167.429785-168.606918A168.052973 168.052973 0 0 0 683.429272 526.056347a168.468432 168.468432 0 0 0-167.499028 168.606917z m81.291384 86.761589a124.291342 124.291342 0 0 1 0-174.077122l21.257628 21.811573a93.270439 93.270439 0 0 0 0 130.453976l-21.257628 21.811573z" p-id="6913" fill="#ffffff"></path></svg>
                                    </a>
                                {{- else if eq $category "music" -}}
                                    <a href="https://open.spotify.com/search/{{- $title -}}" target="_blank" rel="noreferrer noopener nofollow" aria-label="play" alt="在线试听" title="在线试听">
                                        <svg t="1709798195323" class="" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="6492" width="28" height="28"><path d="M369.066667 928c-221.44 0-315.733333-94.293333-315.733334-315.733333v-243.2c0-221.44 94.293333-315.733333 315.733334-315.733334h243.2c221.44 0 315.733333 94.293333 315.733333 315.733334v157.866666c0 17.493333-14.506667 32-32 32s-32-14.506667-32-32v-157.866666c0-186.026667-65.706667-251.733333-251.733333-251.733334h-243.2c-186.026667 0-251.733333 65.706667-251.733334 251.733334v243.2c0 186.026667 65.706667 251.733333 251.733334 251.733333h157.866666c17.493333 0 32 14.506667 32 32s-14.506667 32-32 32h-157.866666z" fill="#ffffff" p-id="6493"></path><path d="M192.853333 553.386667c0-51.626667 42.24-93.866667 93.866667-93.866667 51.626667 0 93.866667 42.24 93.866667 93.866667 0 51.626667-42.24 93.866667-93.866667 93.866666-51.626667 0-93.866667-42.24-93.866667-93.866666z m64 0c0 16.213333 13.226667 29.866667 29.866667 29.866666 16.64 0 29.866667-13.226667 29.866667-29.866666 0-16.64-13.226667-29.866667-29.866667-29.866667-16.213333 0-29.866667 13.226667-29.866667 29.866667z" fill="#ffffff" p-id="6494"></path><path d="M316.586667 553.386667V304.64c0-38.826667 24.32-70.4 61.44-80.64l123.733333-33.706667c38.4-10.666667 62.72-0.426667 75.946667 9.813334 13.226667 10.24 29.44 30.72 29.44 70.4V512c0 17.493333-14.506667 32-32 32s-32-14.506667-32-32V270.506667c0-13.653333-2.986667-18.773333-4.266667-19.626667-1.28-0.853333-7.253333-2.56-20.48 0.853333l-123.306667 33.706667c-12.8 3.413333-14.506667 12.373333-14.506666 18.773333v248.746667c0 17.92-14.506667 32.426667-32 32.426667s-32-14.506667-32-32z" fill="#ffffff" p-id="6495"></path><path d="M419.413333 512c0-51.626667 42.24-93.866667 93.866667-93.866667 51.626667 0 93.866667 42.24 93.866667 93.866667a93.866667 93.866667 0 0 1-93.866667 93.866667c-51.626667 0-93.866667-42.24-93.866667-93.866667z m64 0.426667c0 16.213333 13.226667 29.866667 29.866667 29.866666 16.64 0 29.866667-13.226667 29.866667-29.866666 0-16.64-13.653333-29.866667-29.866667-29.866667-16.213333 0-29.866667 13.226667-29.866667 29.866667z" fill="#ffffff" p-id="6496"></path><path d="M317.866667 385.28a32 32 0 0 1 22.613333-39.253333l226.56-61.866667c17.066667-4.266667 34.56 5.546667 39.253333 22.613333 4.693333 17.066667-5.546667 34.56-22.613333 39.253334L357.12 407.893333c-2.986667 0.426667-5.973333 0.853333-8.533333 0.853334-14.08 0-26.88-9.386667-30.72-23.466667z" fill="#ffffff" p-id="6497"></path><path d="M596.906667 771.413333c0-93.013333 75.52-168.533333 168.533333-168.533333s168.533333 75.52 168.533333 168.533333-75.52 168.533333-168.533333 168.533334-168.533333-75.52-168.533333-168.533334z m64 0c0 57.6 46.933333 104.533333 104.533333 104.533334s104.533333-46.933333 104.533333-104.533334-46.933333-104.533333-104.533333-104.533333-104.533333 46.933333-104.533333 104.533333z" fill="#ffffff" p-id="6498"></path><path d="M904.96 956.16l-42.666667-42.666667a32.170667 32.170667 0 0 1 0-45.226666c12.373333-12.373333 32.853333-12.373333 45.226667 0l42.666667 42.666666c12.373333 12.373333 12.373333 32.853333 0 45.226667-6.4 5.973333-14.506667 9.386667-22.613334 9.386667s-16.213333-2.986667-22.613333-9.386667z" fill="#ffffff" p-id="6499"></path></svg>
                                    </a>
                                {{- else if eq $category "game" -}}
                                    <a href="https://store.steampowered.com/search/?term={{- $title -}}" target="_blank" rel="noreferrer noopener nofollow" aria-label="play" alt="在线游玩" title="在线游玩">
                                        <svg t="1709798925636" class="" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4277" width="28" height="28"><path d="M512.213333 85.333333c-224 0-407.722667 172.8-425.130666 392.405334l228.693333 94.549333a120.448 120.448 0 0 1 67.968-20.992c2.261333 0 4.48 0.128 6.698667 0.213333l101.717333-147.285333v-2.090667c0-88.746667 72.106667-160.853333 160.853333-160.853333a161.109333 161.109333 0 0 1 160.853334 160.938667c0 88.746667-72.149333 160.896-160.853334 160.896h-3.712l-144.938666 103.509333c0 1.834667 0.128 3.754667 0.128 5.674667A120.576 120.576 0 0 1 384 793.045333a121.344 121.344 0 0 1-118.4-96.981333l-163.754667-67.797333C152.490667 807.338667 316.928 938.666667 512.256 938.666667c235.605333 0 426.581333-191.018667 426.581333-426.666667 0-235.605333-191.018667-426.666667-426.624-426.666667zM302.08 711.125333c9.301333 19.285333 25.386667 35.498667 46.72 44.416a90.709333 90.709333 0 0 0 118.613333-118.186666 90.581333 90.581333 0 0 0-115.712-50.261334l54.144 22.442667a66.773333 66.773333 0 0 1-51.370666 123.264l-52.394667-21.674667z m458.24-309.12a107.349333 107.349333 0 0 0-107.221333-107.178666 107.221333 107.221333 0 1 0 107.221333 107.178666zM653.312 321.28A80.64 80.64 0 0 1 733.866667 401.834667a80.64 80.64 0 0 1-80.554667 80.554666 80.512 80.512 0 1 1 0-161.109333z" fill="#ffffff" p-id="4278"></path></svg>
                                    </a>
                                {{- else if eq $category "podcast" -}}
                                    <a href="https://open.spotify.com/search/{{- $title -}}" target="_blank" rel="noreferrer noopener nofollow" aria-label="play" alt="在线收听" title="在线收听">
                                        <svg t="1709818177671" class="" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5314" width="28" height="28"><path d="M768 128H256C185.429333 128 128 185.429333 128 256v512c0 70.570667 57.429333 128 128 128h512c70.570667 0 128-57.429333 128-128V256c0-70.570667-57.429333-128-128-128z m-213.12 651.904c-7.68 22.101333-28.757333 30.762667-42.88 30.762667s-35.2-8.661333-42.88-30.762667c-7.68-22.101333-21.12-98.602667-21.12-149.888S493.397333 576 512 576s64 2.773333 64 54.016c0 51.285333-13.482667 127.786667-21.12 149.888zM458.666667 480a53.333333 53.333333 0 1 1 106.666666 0 53.333333 53.333333 0 0 1-106.666666 0zM512 362.666667c-70.570667 0-128 57.429333-128 128 0 34.304 13.738667 65.365333 35.797333 88.362666a103.04 103.04 0 0 0-13.482666 44.586667C367.018667 592.298667 341.333333 544.682667 341.333333 490.666667c0-94.122667 76.544-170.666667 170.666667-170.666667s170.666667 76.544 170.666667 170.666667c0 54.016-25.685333 101.632-64.938667 132.949333a103.808 103.808 0 0 0-13.482667-44.586667A127.445333 127.445333 0 0 0 640 490.666667c0-70.570667-57.429333-128-128-128z m99.541333 363.861333c2.218667-16.896 4.096-34.304 5.333334-51.242667C681.301333 638.506667 725.333333 569.984 725.333333 490.666667c0-117.632-95.701333-213.333333-213.333333-213.333334s-213.333333 95.701333-213.333333 213.333334c0 79.317333 44.032 147.84 108.458666 184.618666 1.28 16.938667 3.114667 34.346667 5.333334 51.242667A256.384 256.384 0 0 1 256 490.666667c0-141.184 114.816-256 256-256s256 114.816 256 256a256.384 256.384 0 0 1-156.458667 235.861333z" fill="#ffffff" p-id="5315"></path></svg>
                                    </a>
                                {{- else -}}
                                    <a href="https://neodb.social/search?q={{- $title -}}c=all" target="_blank" rel="noreferrer noopener nofollow" aria-label="play" alt="搜索" title="搜索">
                                        <svg t="1709818177671" class="" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5314" width="28" height="28"><path d="M768 128H256C185.429333 128 128 185.429333 128 256v512c0 70.570667 57.429333 128 128 128h512c70.570667 0 128-57.429333 128-128V256c0-70.570667-57.429333-128-128-128z m-213.12 651.904c-7.68 22.101333-28.757333 30.762667-42.88 30.762667s-35.2-8.661333-42.88-30.762667c-7.68-22.101333-21.12-98.602667-21.12-149.888S493.397333 576 512 576s64 2.773333 64 54.016c0 51.285333-13.482667 127.786667-21.12 149.888zM458.666667 480a53.333333 53.333333 0 1 1 106.666666 0 53.333333 53.333333 0 0 1-106.666666 0zM512 362.666667c-70.570667 0-128 57.429333-128 128 0 34.304 13.738667 65.365333 35.797333 88.362666a103.04 103.04 0 0 0-13.482666 44.586667C367.018667 592.298667 341.333333 544.682667 341.333333 490.666667c0-94.122667 76.544-170.666667 170.666667-170.666667s170.666667 76.544 170.666667 170.666667c0 54.016-25.685333 101.632-64.938667 132.949333a103.808 103.808 0 0 0-13.482667-44.586667A127.445333 127.445333 0 0 0 640 490.666667c0-70.570667-57.429333-128-128-128z m99.541333 363.861333c2.218667-16.896 4.096-34.304 5.333334-51.242667C681.301333 638.506667 725.333333 569.984 725.333333 490.666667c0-117.632-95.701333-213.333333-213.333333-213.333334s-213.333333 95.701333-213.333333 213.333334c0 79.317333 44.032 147.84 108.458666 184.618666 1.28 16.938667 3.114667 34.346667 5.333334 51.242667A256.384 256.384 0 0 1 256 490.666667c0-141.184 114.816-256 256-256s256 114.816 256 256a256.384 256.384 0 0 1-156.458667 235.861333z" fill="#ffffff" p-id="5315"></path></svg>
                                    </a>
                                {{- end -}}
                            </div>
                        </div>
                    </div>
                </div>
                {{ end }}
            </div>
          </div>

        </div>

      </div>

    </section>

</article>

{{ $lazyloadJS := resources.Get "js/lazyload.iife.min.js" | minify | fingerprint "sha256" }}
<script type="text/javascript" src="{{ $lazyloadJS.RelPermalink }}" integrity="{{ $lazyloadJS.Data.Integrity }}"></script>

<script>
    var lazyLoadInstance = new LazyLoad({
        // Your custom settings go here
    });
</script>

<script>
    const buttons = document.querySelectorAll('.category-item');
    const cards = document.querySelectorAll('.card');

    buttons.forEach(button => {
        button.addEventListener('click', (event) => {
            const category = event.target.dataset.category;
            buttons.forEach(btn => {
                btn.classList.remove('bg-neutral-700');
                btn.classList.remove('text-neutral-100');
                btn.classList.remove('dark:bg-neutral-100');
                btn.classList.remove('dark:text-neutral-600');
                btn.classList.add('bg-neutral-100');
                btn.classList.add('text-neutral-600');
                btn.classList.add('dark:bg-neutral-700');
                btn.classList.add('dark:text-neutral-100');
            });
            event.target.classList.add('bg-neutral-700');
            event.target.classList.add('text-neutral-100');
            event.target.classList.add('dark:bg-neutral-100');
            event.target.classList.add('dark:text-neutral-600');
            event.target.classList.remove('bg-neutral-100');
            event.target.classList.remove('text-neutral-600');
            event.target.classList.remove('dark:bg-neutral-700');
            event.target.classList.remove('dark:text-neutral-100');

            if (category === 'all') {
                cards.forEach(card => {
                    card.classList.remove('hidden');
                });
            } else {
                cards.forEach(card => {
                    if (card.classList.contains(`m-cate-${category}`)) {
                        card.classList.remove('hidden');
                    } else {
                        card.classList.add('hidden');
                    }
                });
            }
        });
    });
</script>

<script>
  const spanElement = document.querySelector('.neodb_random');
  const popupElement = document.getElementById('moviePopup');
  const countdownElement = document.getElementById('countdown');
  const closePopupButton = document.getElementById('closePopup');

  // 检查 localStorage 中的倒计时状态、电影标题和 uuid
  const randomMovieDuration = localStorage.getItem('randomMovieDuration');
  const randomMovieTitle = localStorage.getItem('randomMovieTitle');
  const randomMovieUUID = localStorage.getItem('randomMovieUUID');
  if (randomMovieDuration && randomMovieTitle && randomMovieUUID) {
      const remainingTime = parseInt(randomMovieDuration) - Math.floor(Date.now() / 1000);
      if (remainingTime > 0) {
          spanElement.innerText = '今天看什么？（随机）';
          countdownElement.innerText = `（请等待 ${Math.floor(remainingTime / 60)}:${remainingTime % 60 < 10 ? '0' : ''}${remainingTime % 60}）`;
          spanElement.disabled = true;
          startCountdown(remainingTime, randomMovieTitle, randomMovieUUID);
      } else {
          localStorage.removeItem('randomMovieDuration');
          localStorage.removeItem('randomMovieTitle');
          localStorage.removeItem('randomMovieUUID');
          spanElement.innerText = '今天看什么？（随机）';
          spanElement.disabled = false;
      }
  }

  spanElement.addEventListener('click', function() {
      if (spanElement.disabled) {
          // 如果倒计时正在进行，使用上一次的 uuid 重新请求数据
          fetch(`https://api.eallion.com/movie/random?type=json&uuid=${randomMovieUUID}`)
              .then(response => response.json())
              .then(data => {
                  // 渲染弹出层
                  renderPopup(data);
              })
              .catch(error => {
                  console.error('Error fetching data:', error);
              });
          return;
      }

      fetch('https://api.eallion.com/movie/random?type=json')
          .then(response => response.json())
          .then(data => {
              // 渲染弹出层
              renderPopup(data);

              // 从 duration 中提取第一个数字作为分钟数
              const durationMatch = data.duration.match(/\d+/) || ["90"];
              const minutes = durationMatch ? parseInt(durationMatch[0]) : 0;

              // 禁用点击功能并开始倒计时
              spanElement.innerText = '今天看什么？（随机）';
              spanElement.disabled = true;

              // 存储倒计时状态、电影标题和 uuid
              const endTime = Math.floor(Date.now() / 1000) + minutes * 60;
              localStorage.setItem('randomMovieDuration', endTime.toString());
              localStorage.setItem('randomMovieTitle', data.title);
              localStorage.setItem('randomMovieUUID', data.uuid);

              // 开始倒计时
              startCountdown(minutes * 60, data.title, data.uuid);
          })
          .catch(error => {
              console.error('Error fetching data:', error);
          });
  });

  closePopupButton.addEventListener('click', function() {
      popupElement.style.display = 'none';
  });

  function startCountdown(remainingTime, title, uuid) {
      const countdownInterval = setInterval(() => {
          remainingTime--;
          const minutesLeft = Math.floor(remainingTime / 60);
          const secondsLeft = remainingTime % 60;
          spanElement.innerText = '今天看什么？（随机）';
          countdownElement.innerText = `（请等待 ${Math.floor(remainingTime / 60)}:${remainingTime % 60 < 10 ? '0' : ''}${remainingTime % 60}）`;

          if (remainingTime <= 0) {
              clearInterval(countdownInterval);
              localStorage.removeItem('randomMovieDuration');
              localStorage.removeItem('randomMovieTitle');
              localStorage.removeItem('randomMovieUUID');
              spanElement.innerText = '今天看什么？（随机）';
              countdownElement.innerText = '（倒记时忆结束！）';
              spanElement.disabled = false;
          }
      }, 1000);
  }

  function renderPopup(data) {
      document.getElementById('movieId').href = data.id;
      document.getElementById('movieTitle').innerText = data.title;
      document.getElementById('randomMovieYear').innerText = `(${data.year})`;
      document.getElementById('randomMovieCover').src = data.cover_image_url;
      document.getElementById('movieDescription').innerText = data.description.trim();

      document.getElementById('randomMovieRating').innerText = data.rating;
      document.getElementById('randomMovieRatingCount').innerText = data.rating_count;
      const ratingElement = document.getElementById('ratingWidth');
      const ratingWidth = data.rating * 10;
      ratingElement.style.width = `${ratingWidth}%`;

      const otherTitle = document.getElementById('otherTitle');
      otherTitle.innerHTML = ''; // 清空之前的 other_title
      data.other_title.forEach(other_title => {
          const otherTitleElement = document.createElement('span');
          otherTitleElement.innerText = other_title;
          otherTitleElement.className = 'mr-1 inline-block whitespace-nowrap rounded text-white capitalize p-1 text-sm text-neutral-200 bg-neutral-700 dark:text-neutral-700 dark:bg-neutral-200'; // 添加样式类
          otherTitle.appendChild(otherTitleElement);
      });

      const genreContainer = document.getElementById('randomMovieGenre');
      genreContainer.innerHTML = ''; // 清空之前的 genre

      // 只取前5个分类
      const genreToShow = data.genre.slice(0, 5);

      genreToShow.forEach(genre => {
          const genreElement = document.createElement('span');
          genreElement.innerText = genre;
          genreElement.className = 'mr-1 inline-block whitespace-nowrap rounded text-white capitalize p-1 text-sm text-neutral-200 bg-neutral-700 dark:text-neutral-700 dark:bg-neutral-200'; // 添加样式类
          genreContainer.appendChild(genreElement);
      });

      const movieDirector = document.getElementById('movieDirector');
      movieDirector.innerHTML = ''; // 清空之前的 director
      data.director.forEach(director => {
          const directorElement = document.createElement('span');
          directorElement.innerText = director;
          directorElement.className = 'mr-1 inline-block whitespace-nowrap rounded text-white capitalize p-1 text-sm text-neutral-200 bg-neutral-700 dark:text-neutral-700 dark:bg-neutral-200'; // 添加样式类
          movieDirector.appendChild(directorElement);
      });

      const movieActor = document.getElementById('movieActor');
      movieActor.innerHTML = ''; // 清空之前的 actor

      // 只取前10个演员
      const actorsToShow = data.actor.slice(0, 10);

      actorsToShow.forEach(actor => {
          const actorElement = document.createElement('span');
          actorElement.innerText = actor;
          actorElement.className = 'mr-1 inline-block whitespace-nowrap rounded text-white capitalize p-1 text-sm text-neutral-200 bg-neutral-700 dark:text-neutral-700 dark:bg-neutral-200'; // 添加样式类
          movieActor.appendChild(actorElement);
      });

      // 显示弹出层
      popupElement.style.display = 'block';
  }
</script>
{{ end }}
