{{ define "main" }}
{{ .Scratch.Set "scope" "single" }}
{{ $goodsCss := resources.Get "css/goods.css" | minify | fingerprint "sha256" }}
<link rel="stylesheet" href="{{ $goodsCss.RelPermalink }}" integrity="{{ $goodsCss.Data.Integrity }}" crossorigin="anonymous">
<article>
  {{ if .Params.showHero | default (.Site.Params.article.showHero | default false) }}
  {{ $heroStyle := .Params.heroStyle }}
  {{ if not $heroStyle }}{{ $heroStyle = .Site.Params.article.heroStyle }}{{ end }}
  {{ $heroStyle := print "hero/" $heroStyle ".html" }}
  {{ if templates.Exists ( printf "partials/%s" $heroStyle ) }}
  {{ partial $heroStyle . }}
  {{ else }}
  {{ partial "hero/basic.html" . }}
  {{ end }}
  {{ end }}
  <header id="single_header" class="mt-5 max-w-prose">
    {{ if .Params.showBreadcrumbs | default (.Site.Params.article.showBreadcrumbs | default false) }}
    {{ partial "breadcrumbs.html" . }}
    {{ end }}
    <h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">
      {{ .Title }}
    </h1>
    <div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden">
      {{ partial "article-meta/basic.html" (dict "context" . "scope" "single") }}
    </div>
  </header>
  <section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row">
      <div class="min-w-0 min-h-0 max-w-fit">
        <div class="article-content max-w-full mb-20">
            {{ .Content }}
            <div id="goods">
                {{ $goodsResource := resources.Get "data/goods/goods.json" }}
                {{ if $goodsResource }}
                    {{ $goods := $goodsResource | transform.Unmarshal }}
                    {{ if $goods }}
                        {{ range sort $goods "date" "desc" }}
                            {{ $goodsSrc := .image }}
                            <div class="goods-container img-hide">
                                <div class="goods-image">
                                    <figure class="mt-0 mb-0">
                                        <a href="https://images.eallion.com/directus/files/{{- $goodsSrc -}}!goodsoriginal.avif">
                                            <picture class="block mt-0 mb-0">
                                                <source data-srcset="https://images.eallion.com/directus/files/{{- $goodsSrc -}}!goods.avif" type="image/avif">
                                                <img
                                                    class="my-0 rounded-md lazy"
                                                    loading="lazy"
                                                    src="/assets/images/goods/goods.webp"
                                                    data-src="https://images.eallion.com/directus/files/{{- $goodsSrc -}}"
                                                    alt="{{- .title -}}"
                                                />
                                            </picture>
                                        </a>
                                    </figure>
                                </div>
                                <div class="goods-price flex justify-start items-center"><span>{{- .currency -}}{{- printf "%.2f" (float .price) -}}</span><span class="ml-2.5 text-sm text-neutral-400">({{ dateFormat "Jan 2, 2006" .date }})</span></div>
                                <div class="goods-title"><a href="/go/?target={{- .link | base64Encode -}}" target="_blank" rel="noreferrer noopener nofollow">{{- .title -}}</a></div>
                                <div class="goods-report-coupon-btn">
                                    {{ if or (not .report) (eq .report "") }}
                                        <div class="goods-report goods-report-empty">
                                            试用报告
                                        </div>
                                    {{ else }}
                                        <div class="goods-report">
                                            <a href="{{- .report -}}" target="_blank" rel="noreferrer noopener nofollow">试用报告</a>
                                        </div>
                                    {{ end }}
                                    <div class="goods-coupon"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" width="1rem" height="1rem" viewBox="0 0 512 512"><path fill="currentColor" d="M157.52 272h36.96L176 218.78zM352 256c-13.23 0-24 10.77-24 24s10.77 24 24 24s24-10.77 24-24s-10.77-24-24-24M464 64H48C21.5 64 0 85.5 0 112v288c0 26.5 21.5 48 48 48h416c26.5 0 48-21.5 48-48V112c0-26.5-21.5-48-48-48M250.58 352h-16.94c-6.81 0-12.88-4.32-15.12-10.75L211.15 320h-70.29l-7.38 21.25A16 16 0 0 1 118.36 352h-16.94c-11.01 0-18.73-10.85-15.12-21.25L140 176.12A23.995 23.995 0 0 1 162.67 160h26.66A23.99 23.99 0 0 1 212 176.13l53.69 154.62c3.61 10.4-4.11 21.25-15.11 21.25M424 336c0 8.84-7.16 16-16 16h-16c-4.85 0-9.04-2.27-11.98-5.68c-8.62 3.66-18.09 5.68-28.02 5.68c-39.7 0-72-32.3-72-72s32.3-72 72-72c8.46 0 16.46 1.73 24 4.42V176c0-8.84 7.16-16 16-16h16c8.84 0 16 7.16 16 16z"/></svg></span> <a href="https://www.kubaicai.com/?r=/l/ddlist&kw={{ .title }}&t=223&origin_id=" target="_blank" rel="noreferrer noopener nofollow">搜搜优惠券？</a></div>
                                </div>
                                <div class="goods-note">{{ .note | safeHTML }}</div>
                            </div>
                        {{ end }}
                    {{ end }}
                {{ end }}
            </div>
            </div>
        </div>
    </section>
</article>
{{ $lazyloadJS := resources.Get "js/lazyload.iife.min.js" | fingerprint "sha256" }}
<script type="text/javascript" src="{{ $lazyloadJS.RelPermalink }}" integrity="{{ $lazyloadJS.Data.Integrity }}"></script>
<script>
    var lazyLoadInstance = new LazyLoad({
        // Your custom settings go here
    });
</script>

{{ $viewJS := resources.Get "js/view-image.min.js" | fingerprint "sha256" }}
<script type="text/javascript" src="{{ $viewJS.RelPermalink }}" integrity="{{ $viewJS.Data.Integrity }}"></script>
<script>
    window.ViewImage && ViewImage.init('.goods-image a');
</script>

{{ end }}
